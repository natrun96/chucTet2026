<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gieo Qu·∫ª ƒê·∫ßu NƒÉm 2026</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üßß</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    
    <style>
        /* ==========================================================
           1. C·∫§U H√åNH CHUNG & T·ªêI ∆ØU HI·ªÜU NƒÇNG
           ========================================================== */
        body { margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; height: 100dvh; background: linear-gradient(135deg, #8a0000 0%, #ff1a1a 100%); font-family: 'Segoe UI', Roboto, Arial, sans-serif; overflow: hidden; text-align: center; color: white; }
        
        /* Ng·ª±a Phi */
        .horse-container { position: absolute; bottom: 15px; left: -300px; z-index: 5; pointer-events: none; display: flex; gap: -20px; animation: runAcross 7s linear infinite; will-change: transform; }
        .horse-unit { font-size: 80px; display: inline-block; transform: scaleX(-1); filter: drop-shadow(5px 5px 5px rgba(0,0,0,0.5)); will-change: transform; }
        .galloping { animation: gallop 0.6s ease-in-out infinite alternate; }
        .horse-red { filter: hue-rotate(-50deg) saturate(2) drop-shadow(5px 5px 5px rgba(0,0,0,0.5)); }
        .horse-gold { filter: hue-rotate(45deg) saturate(3) brightness(1.2) drop-shadow(5px 5px 5px rgba(0,0,0,0.5)); animation-delay: 0.1s; }
        .horse-brown { animation-delay: 0.2s; }
        @keyframes runAcross { 0% { transform: translateX(0); } 100% { transform: translateX(calc(100vw + 500px)); } }
        @keyframes gallop { 0% { transform: scaleX(-1) translateY(0) rotate(0deg); } 100% { transform: scaleX(-1) translateY(-20px) rotate(5deg); } }

        /* N√∫t Loa & G·ª£i √Ω */
        .sound-control { position: fixed; top: 20px; right: 20px; width: 25px; height: 25px; background: rgba(0, 0, 0, 0.6); border: 2px solid #ffd700; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 18px; cursor: pointer; z-index: 200; transition: transform 0.2s; animation: pulse-btn 2s infinite; }
        .speaker-hint { position: fixed; top: 20px; right: 50px; z-index: 200; color: #fff; font-size: 12px; font-weight: bold; background: #d00000; padding: 2px 5px; border-radius: 40px; border: 1px solid #ffd700; box-shadow: 0 0 10px rgba(255, 215, 0, 0.8); pointer-events: none; display: flex; align-items: center; gap: 5px; animation: hint-bounce 1s infinite alternate; white-space: nowrap; }
        .speaker-hint::after { content: '‚û°Ô∏è'; font-size: 18px; }
        @keyframes hint-bounce { 0% { transform: translateX(0); } 100% { transform: translateX(-5px); } }
        @keyframes pulse-btn { 0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(255, 215, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); } }

        /* Bao L√¨ X√¨ Kh·ªüi ƒê·∫ßu */
        #envelope { width: 300px; height: 450px; background: linear-gradient(to bottom, #b30000, #e60000); border: 4px solid #ffd700; border-radius: 20px; cursor: pointer; display: flex; flex-direction: column; justify-content: center; align-items: center; box-shadow: 0 10px 50px rgba(0,0,0,0.7); transition: transform 0.3s; z-index: 20; position: relative; margin-bottom: 80px; }
        #envelope:hover { transform: scale(1.05); }
        .envelope-icon { font-size: 80px; margin-bottom: -10px; filter: drop-shadow(0 4px 4px rgba(0,0,0,0.3)); }
        .year-text { font-size: 35px; font-weight: 900; color: #ffd700; text-shadow: 3px 3px 0px #8b0000; font-family: 'Arial Black', sans-serif; margin-bottom: 10px; }
        .click-hint { font-size: 18px; font-weight: bold; margin-top: 20px; animation: blink 1.5s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }

        /* C√¢u ƒê·ªëi */
        .couplet { position: fixed; top: 50%; width: 48px; background: linear-gradient(to bottom, #b30000, #990000); border: 3px solid #ffd700; border-radius: 4px; color: #ffd700; font-family: 'Times New Roman', serif; font-weight: 900; text-align: center; padding: 15px 0; box-shadow: 4px 4px 15px rgba(0,0,0,0.5), inset 0 0 10px rgba(0,0,0,0.3); z-index: 5; display: flex; flex-direction: column; align-items: center; gap: 6px; animation: floatCouplet 3s ease-in-out infinite alternate; will-change: transform; }
        .couplet-left { left: 8px; } .couplet-right { right: 8px; animation-delay: -1.5s; }
        .couplet span { display: block; font-size: 13px; line-height: 1.2; text-shadow: 1px 1px 2px rgba(0,0,0,0.6); width: 100%; white-space: nowrap; }
        .couplet-cap-top, .couplet-cap-bottom { position: absolute; left: 50%; transform: translateX(-50%); width: 58px; height: 8px; background: linear-gradient(to right, #ffd700, #e6c300, #ffd700); border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .couplet-cap-top { top: -5px; } .couplet-cap-bottom { bottom: -5px; }
        @keyframes floatCouplet { 0% { transform: translateY(calc(-50% - 10px)); } 100% { transform: translateY(calc(-50% + 10px)); } }

        /* ==========================================================
           2. N·ªòI DUNG L·ªúI CH√öC & GAME
           ========================================================== */
        #content { display: none; background: #fffaf0; padding: 20px 20px; border-radius: 20px; box-shadow: 0 0 60px rgba(255, 204, 0, 0.9); width: 360px; max-width: 90%; border: 3px solid #d41414; position: relative; z-index: 20; margin-bottom: 10px; max-height: 85dvh; overflow-y: auto; scroll-behavior: smooth; }
        @keyframes popIn { 0% { opacity: 0; transform: scale(0.5); } 100% { opacity: 1; transform: scale(1); } }
        h1.title-tet { color: #d00000; font-size: 24px; font-weight: bold; margin-bottom: 5px; margin-top: 0px;}
        .horse-icons-top { font-size: 28px; margin: 0px 0 10px 0; }
        .wishes { font-size: 16px; line-height: 1.6; color: #333; font-style: italic; font-weight: 600; background: #fff; padding: 15px; border-radius: 10px; border: 1px dashed #d00000; margin-bottom: 15px; text-align: left; }
        .writing-pen { display: inline-block; font-size: 20px; margin-left: 5px; animation: write-move 0.3s infinite alternate; }
        @keyframes write-move { 0% { transform: rotate(0deg) translateY(0); } 100% { transform: rotate(15deg) translateY(-5px); } }
        #extra-image-container { display: none; margin-bottom: 15px; text-align: center;}
        .my-custom-img { width: 100%; max-width: 100%; border-radius: 10px; border: 3px solid #d00000; box-shadow: 0 5px 15px rgba(0,0,0,0.2); display: block; margin: 0 auto; cursor: zoom-in; opacity: 0; filter: blur(20px) brightness(1.2); transform: scale(1.1); animation: cinematicReveal 1.5s ease-out forwards; }
        .image-caption { margin-top: 8px; font-size: 15px; font-weight: 800; color: #b30000; text-shadow: 1px 1px 0px rgba(255,255,255,0.8); font-style: italic; opacity: 0; animation: fadeIn 1s ease-out forwards; animation-delay: 1s; }
        @keyframes cinematicReveal { 0% { opacity: 0; filter: blur(20px) brightness(1.5); transform: scale(1.15); } 50% { opacity: 0.8; filter: blur(5px) brightness(1.1); } 100% { opacity: 1; filter: blur(0) brightness(1); transform: scale(1); } }

        /* GAME CH·ªÆ */
        #interactive-section { border-top: 1px dashed #d00000; padding-top: 15px; margin-top: 15px; }
        .year-label { display: block; text-align: center; font-size: 22px; font-weight: bold; color: #d00000; margin-top: 0px; margin-bottom: 10px; }
        .scramble-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 4px; margin-bottom: 5px; padding: 0; }
        .letter-chip { background: linear-gradient(to bottom, #ffd700, #fdb931); color: #d00000; font-weight: bold; font-size: 16px; padding: 5px 8px; border-radius: 6px; border: 1px solid #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.2); cursor: pointer; user-select: none; transition: all 0.2s; display: flex; justify-content: center; align-items: center; min-width: 14px; text-align: center; }
        .letter-chip.selected { border: 1px solid #d00000; background: #fff; color: #d00000; transform: scale(1.15) translateY(-3px); box-shadow: 0 4px 8px rgba(0,0,0,0.3); z-index: 10; }
        .letter-chip.correct { background: #28a745 !important; color: white !important; border-color: #fff !important; cursor: default; animation: popSuccess 0.5s forwards; }
        @keyframes popSuccess { 50% { transform: scale(1.15); background: #20c997; } 100% { transform: scale(1); } }
        .space-chip { width: 10px; } 
        .game-instruction { font-size: 13px; font-style: italic; color: #666; margin-top: 12px; margin-bottom: 10px; animation: blink 2s infinite; padding: 0; text-align: center; display: block; }
        .celebration-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.75); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); z-index: 9998; opacity: 0; animation: fadeInOutBackdrop 3s ease-in-out forwards; }
        @keyframes fadeInOutBackdrop { 0% { opacity: 0; } 10% { opacity: 1; } 85% { opacity: 1; } 100% { opacity: 0; } }
        .celebration-popup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0); font-size: 38px; font-weight: 900; color: #ffd700; text-shadow: 0 0 20px #ff0000, 2px 2px 0px #8b0000, -2px -2px 0px #8b0000; z-index: 9999; white-space: nowrap; pointer-events: none; animation: zoomPopCenter 3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        @keyframes zoomPopCenter { 0% { transform: translate(-50%, -50%) scale(0); opacity: 0; } 15% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; } 85% { transform: translate(-50%, -50%) scale(1); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(0.2); opacity: 0; } }
        .static-highlight { display: block; text-align: center; font-size: 26px; font-weight: 900; color: #d00000; text-shadow: 1px 1px 0px rgba(255,255,255,0.5); margin-top: 5px; margin-bottom: 20px; animation: popIn 0.5s; text-wrap: balance; }
        .btn-lucky { display: none; padding: 12px 30px; margin: 0 auto; background: linear-gradient(to right, #ffd700, #fdb931); color: #d00000; font-weight: bold; border-radius: 50px; border: 2px solid #fff; cursor: pointer; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.5); font-size: 16px; transition: transform 0.2s; animation: pulse-gold 1.5s infinite; }
        @keyframes pulse-gold { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); } 50% { transform: scale(1.05); box-shadow: 0 0 0 15px rgba(255, 215, 0, 0); } 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); } }

        /* --- XIN KEO & TR·∫¢ QU·∫∫ --- */
        #shakingModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 3000; justify-content: center; align-items: center; flex-direction: column; }
        .fortune-container { width: 100px; height: 160px; background: linear-gradient(to right, #b30000, #d00000, #b30000); border: 4px solid #ffd700; border-radius: 10px 10px 30px 30px; position: relative; animation: shake-hard 0.4s ease-in-out infinite; box-shadow: 0 10px 30px rgba(0,0,0,0.6); }
        .fortune-container::before { content: ''; position: absolute; top: -15px; left: 5px; width: 82px; height: 25px; background: #800000; border: 4px solid #ffd700; border-radius: 50%; z-index: 2; }
        .sticks-bundle { position: absolute; top: -40px; left: 20px; width: 60px; height: 60px; z-index: 1; }
        .stick-sample { position: absolute; width: 10px; height: 80px; background: #f0e68c; border-radius: 5px; border: 1px solid #d4a017; }
        .stick-sample:nth-child(1) { left: 10px; transform: rotate(-15deg); top: 10px; } .stick-sample:nth-child(2) { left: 25px; transform: rotate(0deg); top: 0px; } .stick-sample:nth-child(3) { left: 40px; transform: rotate(15deg); top: 10px; }
        @keyframes shake-hard { 0% { transform: rotate(0deg) translateY(0); } 25% { transform: rotate(-10deg) translateY(-10px); } 50% { transform: rotate(0deg) translateY(0); } 75% { transform: rotate(10deg) translateY(10px); } 100% { transform: rotate(0deg) translateY(0); } }
        .shaking-text { color: #ffd700; font-size: 22px; font-weight: bold; margin-top: 40px; text-shadow: 0 0 10px #d00000; animation: blink 1s infinite; }
        
        #resultModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 3000; justify-content: center; align-items: center; animation: fadeIn 0.3s; }
        .bamboo-card { width: 300px; min-height: 450px; background: #fdf5e6; border: 8px solid #d4a017; border-radius: 15px; position: relative; display: flex; flex-direction: column; align-items: center; padding: 0; box-shadow: 0 0 50px rgba(255, 215, 0, 0.5); transform: scale(0.1); opacity: 0; animation: card-reveal 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; overflow: hidden; }
        .card-header { width: 100%; height: 70px; background: #d00000; display: flex; justify-content: center; align-items: center; color: #ffd700; font-size: 35px; font-weight: 900; border-bottom: 4px solid #d4a017; text-transform: uppercase; }
        .card-body { padding: 20px; width: 100%; box-sizing: border-box; text-align: center; color: #5c4033; background-image: linear-gradient(#fdf5e6 1px, transparent 1px), linear-gradient(90deg, #fdf5e6 1px, transparent 1px); background-size: 20px 20px; }
        .fortune-rank { display: inline-block; font-size: 32px; font-weight: 900; font-family: 'Dancing Script', cursive, sans-serif; background: linear-gradient(to right, #d00000, #ff0000); -webkit-background-clip: text; -webkit-text-fill-color: transparent; border: 2px solid #d00000; padding: 5px 25px; border-radius: 50px; margin-bottom: 15px; white-space: nowrap; animation: text-blink 1.5s infinite alternate; }
        @keyframes text-blink { 0% { opacity: 1; filter: drop-shadow(0 0 5px rgba(255, 0, 0, 0.8)); transform: scale(1); } 100% { opacity: 0.6; filter: drop-shadow(0 0 0px rgba(255, 0, 0, 0)); transform: scale(1.02); } }
        .fortune-content p { font-size: 15px; line-height: 1.4; margin: 10px 0; font-weight: 600; border-bottom: 1px dashed #ccc; padding-bottom: 5px; text-wrap: balance; }
        .fortune-content b { color: #d00000; font-size: 17px; }
        .poem { margin-top: 15px; font-style: italic; color: #800000; font-weight: bold; font-size: 15px; text-wrap: balance; }
        .btn-get-money-card { margin-top: auto; margin-bottom: 20px; background: linear-gradient(to right, #d00000, #ff0000); color: #fff; border: none; padding: 12px 30px; border-radius: 50px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.3); font-size: 16px; animation: pulse-gold 1.5s infinite; }
        @keyframes card-reveal { 0% { transform: translateY(200px) scale(0.5); opacity: 0; } 100% { transform: translateY(0) scale(1); opacity: 1; } }

        /* ==========================================================
           3. GIAO DI·ªÜN H√ÅI L·ªòC C√ÇY ƒê√ÄO 3D (ƒê√É T·ªêI ∆ØU & KH·∫ÆC PH·ª§C L·ªñI L·ªÜCH)
           ========================================================== */
        #treeOverlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 4000;
            overflow: hidden; animation: fadeIn 0.8s;
            background: linear-gradient(to bottom, #7EC8E3 0%, #E0F7FA 30%, #FFF0F5 70%, #C1E1C1 100%);
            background-image: radial-gradient(circle at 20% 25%, rgba(255,255,255,0.7) 0%, transparent 25%), 
                              radial-gradient(circle at 80% 40%, rgba(255,240,200,0.5) 0%, transparent 30%);
        }
        
        /* C·ªè non */
        #treeOverlay::after { 
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 18vh; 
            background: linear-gradient(to top, #2d5a27, #5c9955); 
            clip-path: ellipse(150% 100% at 50% 100%); z-index: 1; pointer-events: none;
        }

        /* TI√äU ƒê·ªÄ: Fix l·ªói l·ªách ph·∫£i, cƒÉn gi·ªØa 100% */
        .tree-title { 
            position: absolute; top: 3vh; left: 50%; transform: translateX(-50%); white-space: nowrap;
            color: #d41414; font-size: 42px; font-weight: 900; 
            text-shadow: 2px 2px 0px #fff, 0 0 15px rgba(255,255,255,0.9); 
            font-family: 'Dancing Script', cursive; animation: pulse-gold 2s infinite; z-index: 10; pointer-events: none;
        }

        /* ROOT ANCHOR: ƒê·ªãnh v·ªã chu·∫©n x√°c C√¢y & Ch·∫≠u */
        .tree-root-anchor {
            position: absolute; bottom: 5%; left: 50%; width: 100%; max-width: 500px; transform: translateX(-50%);
            z-index: 10; display: flex; flex-direction: column; align-items: center; justify-content: flex-end;
        }

        /* CHI TI·∫æT CH·∫¨U HOA 3D */
        .pot-lip-back { width: 170px; height: 25px; background: #6b2f15; border-radius: 50%; position: absolute; bottom: 110px; z-index: 1; }
        .pot-soil { width: 155px; height: 18px; background: #2b1408; border-radius: 50%; position: absolute; bottom: 108px; z-index: 2; box-shadow: inset 0 0 10px rgba(0,0,0,0.8);}
        .pot-lip-front { width: 180px; height: 30px; background: linear-gradient(to right, #a0522d, #d2691e, #a0522d); border-radius: 50%; position: absolute; bottom: 100px; z-index: 4; box-shadow: 0 4px 6px rgba(0,0,0,0.4), inset 0 2px 2px rgba(255,255,255,0.2); }
        .pot-body { width: 150px; height: 110px; background: linear-gradient(to right, #703311, #b34d10, #703311); border-radius: 10px 10px 65px 65px; position: absolute; bottom: 0; z-index: 4; display: flex; justify-content: center; align-items: center; box-shadow: inset -15px -10px 20px rgba(0,0,0,0.5), 0 20px 25px rgba(0,0,0,0.6); }
        .pot-body::after { content: '2026'; color: #ffd700; font-size: 32px; font-weight: 900; font-family: 'Arial Black', sans-serif; text-shadow: -1px -1px 0 #cc9900, 2px 2px 3px rgba(0,0,0,0.6); margin-top: 15px;}

        /* C√ÇY ƒê√ÄO SVG (C·∫Øm v√†o ch√≠nh gi·ªØa ƒë·∫•t v√† th√†nh ch·∫≠u) */
        .tree-svg-container, .tree-canopy {
            position: absolute; bottom: 110px; /* N·∫±m ngay tr√™n l·ªõp ƒë·∫•t */
            width: 150vw; max-width: 1200px; min-width: 850px; /* Scale b·ª± v√† bao ph·ªß */
            height: 75vh; max-height: 850px;
            /* CƒÉn gi·ªØa t√¢m c√¢y v·ªõi t√¢m ch·∫≠u tuy·ªát ƒë·ªëi */
            left: 50%; transform: translateX(-50%);
            z-index: 3; pointer-events: none;
        }
        .tree-svg-container svg { width: 100%; height: 100%; filter: drop-shadow(3px 15px 10px rgba(0,0,0,0.3)); overflow: visible; }
        .tree-canopy { z-index: 5; }

        /* HOA ƒê√ÄO & L√Å (Sinh b·∫±ng JS) */
        .svg-flower, .svg-leaf { position: absolute; filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2)); transform-origin: center; will-change: transform; }
        .svg-flower { animation: blossom-pulse 3s infinite alternate; }
        @keyframes blossom-pulse { 0% { transform: scale(0.9); } 100% { transform: scale(1.15); } }

        /* L√å X√å TREO TR√äN C√ÇY */
        .tree-envelope-wrapper { position: absolute; display: flex; flex-direction: column; align-items: center; z-index: 20; transform-origin: top center; pointer-events: auto; animation: env-swing 3s ease-in-out infinite alternate; cursor: pointer; will-change: transform;}
        .env-string { width: 2px; height: 25px; background: #ffd700; box-shadow: 0 0 2px rgba(0,0,0,0.5); }
        .tree-envelope { width: 34px; height: 50px; background: linear-gradient(135deg, #d00000, #ff1a1a); border: 2px solid #ffd700; border-radius: 4px; display: flex; justify-content: center; align-items: center; position: relative; box-shadow: 0 5px 15px rgba(255,0,0,0.4); transition: transform 0.2s; animation: env-blink 1.5s infinite alternate;}
        .tree-envelope-wrapper:hover { animation: none; z-index: 30; transform: scale(1.2); }
        .tree-envelope-wrapper:hover .tree-envelope { box-shadow: 0 0 20px #ffd700; }
        .tree-envelope::before { content: ''; position: absolute; top: -2px; left: -2px; border-left: 17px solid transparent; border-right: 17px solid transparent; border-top: 15px solid #b30000; pointer-events: none; }
        .epass-logo { color: #ffaa00; font-weight: 900; font-size: 9px; text-shadow: 1px 1px 0px #5a0000; transform: rotate(-10deg); pointer-events: none; }
        
        @keyframes env-swing { 0% { transform: rotate(-6deg); } 100% { transform: rotate(6deg); } }
        @keyframes env-blink { 0% { box-shadow: 0 0 5px #ffd700; } 100% { box-shadow: 0 0 15px #ffd700, 0 0 20px rgba(255,0,0,0.6); } }

        /* L√å X√å CLONE BAY RA M√ÄN H√åNH */
        .env-clone-wrap { width: 34px; height: 50px; z-index: 9999; display: flex; flex-direction: column; align-items: center; transition: all 1s cubic-bezier(0.25, 0.1, 0.25, 1); transform-origin: center; will-change: transform, top, left;}
        .env-clone { width: 100%; height: 100%; background: linear-gradient(135deg, #d00000, #ff1a1a); border: 2px solid #ffd700; border-radius: 4px; display: flex; justify-content: center; align-items: center; box-shadow: 0 10px 30px rgba(0,0,0,0.8); position: relative; }
        .env-clone::before { content: ''; position: absolute; top: -2px; left: -2px; border-left: 17px solid transparent; border-right: 17px solid transparent; border-top: 15px solid #b30000; transition: transform 0.6s; transform-origin: top; z-index: 2; }
        .env-clone .epass-logo { color: #ffaa00; font-weight: 900; font-size: 9px; text-shadow: 1px 1px 0px #5a0000; transform: rotate(-10deg); z-index: 3; transition: opacity 0.3s;}
        .qr-pop-out { position: absolute; width: 28px; height: 28px; background: white; z-index: 1; opacity: 0; transition: all 0.6s ease-out; padding: 2px; border: 1px solid #ccc; border-radius: 2px;}
        
        .env-clone-wrap.fly-and-open { top: 50% !important; left: 50% !important; transform: translate(-50%, -50%) scale(6); }
        .env-clone-wrap.fly-and-open .env-clone::before { transform: rotateX(180deg); transition-delay: 1s; opacity: 0; }
        .env-clone-wrap.fly-and-open .epass-logo { opacity: 0; transition-delay: 1s; }
        .env-clone-wrap.fly-and-open .qr-pop-out { opacity: 1; transform: translateY(-38px); transition-delay: 1.2s; box-shadow: 0 5px 10px rgba(0,0,0,0.5); }

        /* ==========================================================
           4. POPUP QR CU·ªêI C√ôNG & HI·ªÜU ·ª®NG N·ªÄN
           ========================================================== */
        #qrOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(50, 0, 0, 0.85); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); z-index: 5000; justify-content: center; align-items: center; flex-direction: column; animation: fadeIn 0.8s; overflow-y: auto; padding: 20px 0; }
        .btn-close-qr { position: absolute; top: 30px; right: 30px; color: #fff; font-size: 40px; cursor: pointer; opacity: 0.8; transition: 0.3s; text-shadow: 0 0 10px rgba(0,0,0,0.5); z-index: 2005; }
        .btn-close-qr:hover { opacity: 1; transform: scale(1.1); }
        .qr-title-large { color: #ffd700; font-size: 28px; font-weight: bold; margin-bottom: 10px; letter-spacing: 1px; text-shadow: 2px 2px 4px rgba(0,0,0,0.6); margin-top: 50px; }
        .qr-note-top { color: #fff; font-style: italic; font-size: 15px; margin-bottom: 15px; text-shadow: 1px 1px 2px rgba(0,0,0,0.8); text-align: center; line-height: 1.4; padding: 0 20px; }
        .qr-img-large { width: 260px; height: 260px; border: 5px solid #ffd700; border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); background: white; margin-bottom: 20px; cursor: zoom-in; transition: transform 0.2s; }
        .qr-img-large:hover { transform: scale(1.02); }
        #qrLightbox { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9999; justify-content: center; align-items: center; flex-direction: column; animation: fadeIn 0.3s; }
        .lightbox-img-content { width: auto; height: auto; max-width: 90%; max-height: 80vh; border: 3px solid #ffd700; border-radius: 10px; box-shadow: 0 0 30px rgba(255, 215, 0, 0.5); background-color: #fff; animation: zoomInPopup 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); cursor: zoom-out; }
        @keyframes zoomInPopup { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .lightbox-hint-text { color: #ccc; margin-top: 15px; font-style: italic; font-size: 14px; animation: blink 2s infinite; }
        .btn-download-bottom { display: flex; align-items: center; gap: 10px; padding: 10px 25px; background: #d00000; border: 2px solid #ffd700; color: #ffd700; border-radius: 50px; text-decoration: none; font-weight: bold; font-size: 16px; transition: 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.3); cursor: pointer; }
        .btn-download-bottom:hover { transform: scale(1.05); background: #b30000; }
        .final-message { margin-top: 25px; margin-bottom: 50px; font-style: italic; color: #fff; font-size: 15px; max-width: 85%; line-height: 1.6; text-shadow: 0 1px 2px rgba(0,0,0,0.8); background: rgba(0, 0, 0, 0.4); border: 1px dashed #ffd700; padding: 15px 20px; border-radius: 15px; opacity: 0; animation: fadeMsg 2s ease-in-out forwards; animation-delay: 0.5s; }
        @keyframes fadeMsg { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* T·ªëi ∆∞u hi·ªáu nƒÉng Hoa r∆°i (Ch·ªâ d√πng 1 keyframe CSS) */
        .flower { position: absolute; top: -10vh; z-index: 10; pointer-events: none; opacity: 0.8; will-change: transform; }
        @keyframes fall { to { transform: translateY(110vh) rotate(var(--fall-rot)); } }

        /* Ph√°o Hoa */
        .firework-shell { position: absolute; pointer-events: none; z-index: 10000; }
        .firework-particle { position: absolute; border-radius: 50%; animation: realistic-burst 1.2s ease-out forwards; will-change: transform, opacity; }
        @keyframes realistic-burst { 0% { transform: translate(0, 0) scale(1); opacity: 1; } 60% { transform: translate(var(--x), var(--y)) scale(0.8); opacity: 0.8; } 100% { transform: translate(var(--x), calc(var(--y) + 80px)) scale(0.4); opacity: 0; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body onclick="playAudioForce()">

    <svg style="display: none;">
        <defs>
            <g id="peach-flower">
                <circle cx="0" cy="-6" r="5.5" fill="#ff99b3"/>
                <circle cx="5.5" cy="-1.5" r="5.5" fill="#ff99b3"/>
                <circle cx="3.5" cy="5" r="5.5" fill="#ff99b3"/>
                <circle cx="-3.5" cy="5" r="5.5" fill="#ff99b3"/>
                <circle cx="-5.5" cy="-1.5" r="5.5" fill="#ff99b3"/>
                <circle cx="0" cy="0" r="3" fill="#ff3366"/>
                <circle cx="0" cy="0" r="1.5" fill="#ffd700"/>
            </g>
            <g id="peach-leaf">
                <path d="M0,0 Q8,-8 15,0 Q8,8 0,0" fill="#4caf50" stroke="#2e7d32" stroke-width="0.5"/>
            </g>
        </defs>
    </svg>

    <div class="couplet couplet-left" id="coupletLeft"><div class="couplet-cap-top"></div><span>V·∫†N</span><span>S·ª∞</span><span>NH∆Ø</span><span>√ù</span><div class="couplet-cap-bottom"></div></div>
    <div class="couplet couplet-right" id="coupletRight"><div class="couplet-cap-top"></div><span>AN</span><span>KHANG</span><span>TH·ªäNH</span><span>V∆Ø·ª¢NG</span><div class="couplet-cap-bottom"></div></div>
    <div class="horse-container"><div class="horse-unit horse-red galloping">üêé</div><div class="horse-unit horse-gold galloping">üêé</div><div class="horse-unit horse-brown galloping">üêé</div></div>

    <div id="envelope" onclick="openEnvelope()">
        <div class="envelope-icon">üßß</div><div class="year-text">Xu√¢n B√≠nh Ng·ªç<br>2026</div><div class="click-hint">Xin m·ªùi ·∫•n v√†o ƒë√¢y üòç</div>
    </div>

    <div id="content">
        <h1 class="title-tet">Ch√∫c M·ª´ng NƒÉm M·ªõi<br>Xu√¢n B√≠nh Ng·ªç 2026!</h1><div class="horse-icons-top">üêé üêé üêé</div>
        <div id="extra-image-container"><img src="Anh-2.jpg" id="mainImage" alt="H√¨nh ·∫£nh team" class="my-custom-img" onclick="openLightbox(this.src)"><div id="imageCaption" class="image-caption"></div></div>
        <div class="wishes">
            <span id="type-text"></span><span id="writing-pen" class="writing-pen">üñåÔ∏è</span>
            <div id="interactive-section" style="display: none;">
                <div id="boardArea"><div class="year-label">2026 - </div><div id="wordContainer" class="scramble-container"></div><div id="gameInstruction" class="game-instruction">(Ch·∫°m v√†o 2 ch·ªØ c√°i ƒë·ªÉ ƒë·ªïi v·ªã tr√≠ cho nhau th√†nh t·ª´ c√≥ nghƒ©a)</div></div>
                <div id="finalTextContainer" style="display: none;"><span class="static-highlight" id="finalText"></span></div>
                <div id="btnLucky" class="btn-lucky" onclick="startShaking()">‚ú® R√∫t Qu·∫ª L·ªôc ƒê·∫ßu NƒÉm üßß</div>
            </div>
        </div>
    </div>

    <div id="shakingModal"><div class="fortune-container"><div class="sticks-bundle"><div class="stick-sample"></div><div class="stick-sample"></div><div class="stick-sample"></div></div></div><div class="shaking-text">ƒêang xin keo... üôè</div></div>
    <div id="resultModal">
        <div class="bamboo-card">
            <div class="card-header"><div>L·ªôc</div></div>
            <div class="card-body"><div class="fortune-rank" id="fortune-word">Ch·ªØ L·ªôc</div><div class="fortune-content" id="fortune-details"></div><div class="poem" id="fortune-poem"></div></div>
            <button class="btn-get-money-card" onclick="showTreeOverlay()">Nh·∫≠n L·ªôc Xu√¢n üßß</button>
        </div>
    </div>

    <div id="treeOverlay">
        <h2 class="tree-title">H√°i L·ªôc ƒê·∫ßu Xu√¢n</h2>
        
        <div class="tree-root-anchor">
            
            <div class="pot-lip-back"></div>
            <div class="pot-soil"></div>
            
            <div class="tree-svg-container">
                <svg viewBox="0 0 1000 800" preserveAspectRatio="none" width="100%" height="100%">
                    <defs>
                        <linearGradient id="bark" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" stop-color="#2a160d"/>
                            <stop offset="30%" stop-color="#4a2e1b"/>
                            <stop offset="50%" stop-color="#5c3a21"/>
                            <stop offset="70%" stop-color="#4a2e1b"/>
                            <stop offset="100%" stop-color="#1f0f08"/>
                        </linearGradient>
                    </defs>
                    <path d="M 540 800 C 550 700, 550 600, 550 500 C 560 350, 650 250, 850 150 C 930 110, 1000 80, 1030 50 C 970 90, 900 140, 800 180 C 670 230, 590 300, 570 380 C 540 280, 410 180, 210 80 C 140 50, 90 20, 70 10 C 120 50, 210 90, 310 140 C 410 210, 480 300, 510 420 C 500 550, 470 700, 460 800 Z" fill="url(#bark)"/>
                    <path d="M 550 500 C 560 400, 610 300, 710 200 C 780 140, 840 90, 880 50 C 840 90, 760 150, 700 220 C 640 290, 590 380, 570 460 Z" fill="url(#bark)"/>
                    <path d="M 510 420 C 460 350, 360 280, 240 220 C 180 190, 120 160, 80 130 C 140 170, 210 210, 300 260 C 390 320, 450 380, 480 460 Z" fill="url(#bark)"/>
                    <path d="M 570 380 C 640 340, 740 310, 860 280 C 940 260, 1010 240, 1040 220 C 980 250, 910 280, 810 310 C 710 340, 610 370, 580 420 Z" fill="url(#bark)"/>
                    <path d="M 555 350 C 540 250, 510 150, 460 50 C 440 20, 410 0, 390 -10 C 420 20, 460 60, 490 120 C 520 200, 540 280, 555 380 Z" fill="url(#bark)"/>
                </svg>
            </div>

            <div class="tree-canopy" id="treeCanopy"></div>

            <div class="pot-lip-front"></div>
            <div class="pot-body"></div>
            
        </div>
    </div>

    <div id="qrOverlay">
        <div class="btn-close-qr" onclick="closeQR()">√ó</div><div class="qr-title-large" id="qrTitle">L√¨ x√¨ t·∫∑ng em</div>
        <div class="qr-note-top">(S·ª≠ d·ª•ng APP Viettel Money ƒë·ªÉ qu√©t QR<br>Ch·∫°m v√†o m√£ ƒë·ªÉ ph√≥ng to, ho·∫∑c nh·∫•n gi·ªØ ƒë·ªÉ l∆∞u ·∫£nh)</div>
        <img src="" alt="QR Code" class="qr-img-large" id="qrImgMain" onclick="openLightbox(this.src)">
        <div class="btn-download-bottom" onclick="forceDownloadQR()"><span>‚¨áÔ∏è</span> T·∫£i m√£ QR</div><div class="final-message" id="finalMsg"></div>
    </div>

    <div id="qrLightbox" onclick="closeLightbox()"><img src="" id="lightboxImg" class="lightbox-img-content"><div class="lightbox-hint-text">(Ch·∫°m ƒë·ªÉ ƒë√≥ng)</div></div>
    <div id="speakerHint" class="speaker-hint">Click ƒë·ªÉ nghe nh·∫°c</div><div id="soundBtn" class="sound-control" onclick="toggleSound(event)">üîá</div><audio id="tetMusic" loop><source src="nhac-tet.mp3" type="audio/mpeg"></audio>

    <script>
        var music = document.getElementById('tetMusic'); var soundBtn = document.getElementById('soundBtn'); var speakerHint = document.getElementById('speakerHint'); var isPlaying = false;
        var flowerInterval;

        const PERSON_DATA = {
            "sep_tung": { group: "boss", wish: "Nh√¢n d·ªãp nƒÉm m·ªõi, em k√≠nh ch√∫c Anh c√πng Gia ƒë√¨nh d·ªìi d√†o s·ª©c kh·ªèe, h·∫°nh ph√∫c, b√¨nh an, v·∫°n s·ª± nh∆∞ √Ω. Em ch√∫c Anh s·∫Ω c√≥ 1 nƒÉm 2026 th·∫≠t th√†nh c√¥ng, d·∫´n d·∫Øt Ph√≤ng KTCN c·ªßa ch√∫ng ta ho√†n th√†nh v∆∞·ª£t m·ªçi ch·ªâ ti√™u v√† ƒë·∫°t ƒë∆∞·ª£c nhi·ªÅu th√†nh t√≠ch cao ·∫°. Em c≈©ng c·∫£m ∆°n Anh ƒë√£ lu√¥n t·∫°o ƒëi·ªÅu ki·ªán, ƒë·ªìng h√†nh v√† h·ªó tr·ª£ ch√∫ng em trong su·ªët 1 nƒÉm qua ·∫° ‚ù§Ô∏è.", highlightText: "V∆∞·ª£t K·∫ø ho·∫°ch", qr: "qr-sep.jpg", fortune: { word: "Th·ªëng Lƒ©nh", content: "<p><b>üëë S·ª± Nghi·ªáp:</b><br>Quy·∫øt ƒëo√°n, d·∫´n d·∫Øt ƒë·ªôi ng≈© v∆∞∆°n xa.</p><p><b>üí∞ T√†i L·ªôc:</b><br>V·ªØng v√†ng, gia tƒÉng kh√¥ng ng·ª´ng.</p><p><b>üè° Gia ƒê·∫°o:</b><br>An khang, th·ªãnh v∆∞·ª£ng, sum v·∫ßy.</p>", poem: "\"C·∫ßm qu√¢n v·ªØng l√°i thuy·ªÅn ra bi·ªÉn<br>V·∫°n s·ª± hanh th√¥ng, ph√∫c l·ªôc ti·ªÅn\"" } },
            "sep_doanh": { group: "boss", wish: "Nh√¢n d·ªãp nƒÉm m·ªõi, em k√≠nh ch√∫c Anh c√πng Gia ƒë√¨nh d·ªìi d√†o s·ª©c kh·ªèe, h·∫°nh ph√∫c, b√¨nh an, v·∫°n s·ª± nh∆∞ √Ω. Em ch√∫c Anh s·∫Ω c√≥ 1 nƒÉm 2026 th·∫≠t th√†nh c√¥ng, d·∫´n d·∫Øt Team ch√∫ng ta lu√¥n g·∫Øn b√≥, ƒëo√†n k·∫øt, ho√†n th√†nh t·ªët m·ªçi nhi·ªám v·ª• ƒë∆∞·ª£c giao. Em c≈©ng c·∫£m ∆°n Anh ƒë√£ lu√¥n t·∫°o ƒëi·ªÅu ki·ªán, l·∫Øng nghe, ƒë·ªìng h√†nh v√† h·ªó tr·ª£ em trong su·ªët 1 nƒÉm qua ·∫° ‚ù§Ô∏è.", highlightText: "V∆∞·ª£t K·∫ø ho·∫°ch", qr: "qr-sep.jpg", fortune: { word: "ƒê·∫Øc Th·∫Øng", content: "<p><b>ü§ù ƒê·ªìng ƒê·ªôi:</b><br>Tr√™n d∆∞·ªõi m·ªôt l√≤ng, s·ª©c m·∫°nh v√¥ song.</p><p><b>üöÄ C√¥ng Vi·ªác:</b><br>Thu·∫≠n bu·ªìm xu√¥i gi√≥, thƒÉng ti·∫øn cao.</p><p><b>üí∞ Ti·ªÅn B·∫°c:</b><br>R·ªßng r·ªânh, ƒë·∫ßu t∆∞ ƒë√¢u th·∫Øng ƒë√≥.</p>", poem: "\"Ph√≥ t∆∞·ªõng t√†i ba, m∆∞u l∆∞·ª£c gi·ªèi<br>C√¥ng th√†nh danh to·∫°i, l·ªôc ƒë·∫ßy nh√†\"" } },
            "e_linh": { group: "member", wish: "Nh√¢n d·ªãp nƒÉm m·ªõi, anh ch√∫c Linh c√≥ th·∫≠t nhi·ªÅu s·ª©c kh·ªèe, h·∫°nh ph√∫c v√† b√¨nh an. Ch√∫c cho nh·ªØng k·∫ø ho·∫°ch, d·ª± ƒë·ªãnh trong nƒÉm 2026 c·ªßa em s·∫Ω ƒë·ªÅu ƒë∆∞·ª£c th·ª±c hi·ªán, g·∫∑t h√°i ƒë∆∞·ª£c nhi·ªÅu k·∫øt qu·∫£ h∆°n n·ªØa trong c√¥ng vi·ªác v√† nhanh ch√≥ng master \"OTC\" nha üòÅ. Ch√∫c ri√™ng chuy·ªán t√¨nh c·∫£m c·ªßa 2 em s·∫Ω lu√¥n m·∫∑n n·ªìng, h·∫°nh ph√∫c, c√πng ƒë·ªìng h√†nh v√† chia s·∫ª v·ªõi nhau nhi·ªÅu h∆°n trong cu·ªôc s·ªëng.", highlightText: "An Nhi√™n", qr: "qr-linh.jpg", fortune: { word: "M·ªπ M√£n", content: "<p><b>üíû T√¨nh Y√™u:</b><br>Th√™m ph·∫ßn m·∫∑n n·ªìng, g·∫Øn k·∫øt, anh ng∆∞·ªùi y√™u lu√¥n th·∫•u hi·ªÉu v√† c∆∞ng chi·ªÅu.</p><p><b>üíÉ Nhan S·∫Øc & S·ª©c Kh·ªèe:</b><br>Ng√†y c√†ng r·∫°ng r·ª°, nhu·∫≠n s·∫Øc, th·ªÉ l·ª±c d·ªìi d√†o.</p><p><b>üí∞ Ti·ªÅn T√†i:</b><br>T√†i l·ªôc hanh th√¥ng, v√≠ l√∫c n√†o c≈©ng cƒÉng ph·ªìng.</p>", poem: "\"T√¨nh n·ªìng th·∫Øm thi·∫øt m·∫∑n m√†<br>Ti·ªÅn t√†i r·ªßng r·ªânh, ng·ªçc ng√† s·∫Øc xu√¢n\"" } },
            "e_kimanh": { group: "member", wish: "Nh√¢n d·ªãp nƒÉm m·ªõi, anh ch√∫c Kim Anh c√≥ th·∫≠t nhi·ªÅu s·ª©c kh·ªèe, ni·ªÅm vui v√† g·∫∑p nhi·ªÅu may m·∫Øn. V·ªõi c√¥ng vi·ªác, anh ch√∫c em s·∫Ω b·ª©t ph√° h∆°n, c·∫©n th·∫≠n h∆°n, ƒëi·ªÅu g√¨ ƒë√£ l√†m t·ªët th√¨ ti·∫øp t·ª•c ph√°t huy, ƒëi·ªÅu g√¨ c√≤n thi·∫øu s√≥t th√¨ s·∫Ω trau d·ªìi, c·∫£i thi·ªán ƒë·ªÉ t·ªët h∆°n m·ªói ng√†y nh√©. V√† quan tr·ªçng s·ªõm t√¨m ƒë∆∞·ª£c 1 anh ng∆∞·ªùi y√™u ƒë·∫πp zai, nhi·ªÅu xi·ªÅn, v√† chi·ªÅu chu·ªông em nha üòù", highlightText: "B·ª©t Ph√°", qr: "qr-kimanh.jpg", fortune: { word: "Hanh Th√¥ng", content: "<p><b>üíñ T√¨nh Duy√™n:</b><br>Bu·ªïi h·∫πn h√≤ l√£ng m·∫°n n·ªü hoa, s·ªõm ng√†y ch√≠nh th·ª©c chung ƒë√¥i.</p><p><b>üíª C√¥ng Vi·ªác:</b><br>Su√¥n s·∫ª thu·∫≠n l·ª£i, 'b√†n tay v√†ng' test ƒë√¢u chu·∫©n ƒë·∫•y, zero bug!</p><p><b>üçÄ May M·∫Øn & Ti·ªÅn T√†i:</b><br>S·ª©c kh·ªèe d·∫ªo dai, ph√∫ qu√Ω ng·∫≠p tr√†n, l√†m ƒë√¢u th·∫Øng ƒë√≥.</p>", poem: "\"T√¨nh duy√™n ch·ªõm n·ªü ng·ªçt ng√†o<br>C√¥ng vi·ªác m∆∞·ª£t m√†, l·ªôc v√†o nh∆∞ m∆∞a\"" } },
            "e_vinh": { group: "member", wish: "Nh√¢n d·ªãp nƒÉm m·ªõi, anh ch√∫c Vinh c√≥ th·∫≠t nhi·ªÅu s·ª©c kh·ªèe, h·∫°nh ph√∫c v√† b√¨nh an, m·ªçi chuy·ªán kh√¥ng vui trong nƒÉm c≈© h√£y cho qua h·∫øt nh√©, ƒë·ªÉ ƒë√≥n nh·∫≠n nh·ªØng ƒëi·ªÅu m·ªõi m·∫ª, vui v·∫ª trong nƒÉm m·ªõi. Ch√∫c em s·∫Ω c√≥ 1 nƒÉm 2026 m·∫°nh m·∫Ω, t·ª± tin, c·ªë g·∫Øng nhi·ªÅu h∆°n n·ªØa ƒë·ªÉ th·ª±c hi·ªán m·ªçi m·ª•c ti√™u, k·∫ø ho·∫°ch, ƒë·∫°t ƒë∆∞·ª£c nhi·ªÅu th√†nh t√≠ch cao trong c√¥ng vi·ªác. V√† ƒë·∫∑c bi·ªát, chuy·ªán t√¨nh c·∫£m s·ªõm ƒë∆∞·ª£c ƒë∆°m hoa k·∫øt tr√°i nha üòú", highlightText: "M·∫°nh M·∫Ω", qr: "qr-vinh.jpg", fortune: { word: "An Y√™n", content: "<p><b>üåª Tinh Th·∫ßn & Gia ƒê√¨nh:</b><br>G√°c l·∫°i mu·ªôn phi·ªÅn, c√µi l√≤ng b√¨nh an, ƒë√≥n nh·∫≠n v√¥ v√†n ni·ªÅm vui m·ªõi.</p><p><b>üíò T√¨nh Duy√™n:</b><br>Kho·∫£ng c√°ch g·∫ßn ngay ch·ªën c√¥ng s·ªü, duy√™n l√†nh ƒë∆∞a t·ªõi, s·ªõm chung l·ªëi v·ªÅ.</p><p><b>üíº C√¥ng Vi·ªác & T√†i L·ªôc:</b><br>Thu·∫≠n bu·ªìm xu√¥i gi√≥, thƒÉng ti·∫øn kh√¥ng ng·ª´ng, ti·ªÅn b·∫°c r·ªßng r·ªânh.</p>", poem: "\"Qua c∆°n m∆∞a, tr·ªùi l·∫°i s√°ng trong<br>T√¨nh duy√™n g√µ c·ª≠a, c√µi l√≤ng an vui\"" } },
            "e_duc": { group: "member", wish: "Nh√¢n d·ªãp nƒÉm m·ªõi, anh ch√∫c ƒê·ª©c c√≥ th·∫≠t nhi·ªÅu s·ª©c kh·ªèe, nhi·ªÅu ni·ªÅm vui v√† g·∫∑p nhi·ªÅu may m·∫Øn. Ch√∫c em 1 nƒÉm 2026 tr∆∞·ªüng th√†nh h∆°n, t·ª± tin h∆°n. Bi·∫øt ƒë∆∞·ª£c ƒëi·ªÉm m·∫°nh ƒë·ªÉ ph√°t huy, ƒëi·ªÉm y·∫øu ƒë·ªÉ trau d·ªìi v√† c·∫£i thi·ªán ng√†y m·ªôt t·ªët h∆°n nh√©.", highlightText: "Tr∆∞·ªüng Th√†nh", qr: "qr-duc.jpg", fortune: { word: "Kh·ªüi S·∫Øc", content: "<p><b>üöÄ C√¥ng Vi·ªác:</b><br>Kh·ªüi ƒë·∫ßu m·ªõi r·ª±c r·ª° v·ªõi b·∫£n h·ª£p ƒë·ªìng ch√≠nh th·ª©c! Ng√†y c√†ng tr∆∞·ªüng th√†nh, t·ª± tin v∆∞∆°n xa.</p><p><b>üíï T√¨nh Y√™u:</b><br>Ng·ªçt ng√†o ƒë·∫Øm say, h·∫°nh ph√∫c ƒëong ƒë·∫ßy b√™n n·ª≠a kia y√™u th∆∞∆°ng.</p><p><b>üçÄ S·ª©c Kh·ªèe & May M·∫Øn:</b><br>Th·ªÉ ch·∫•t khang ki·ªán, ƒëi t·ªõi ƒë√¢u v·∫°n s·ª± c√°t t∆∞·ªùng t·ªõi ƒë√≥.</p>", poem: "\"Ch√≠nh th·ª©c c·∫•t c√°nh bay xa<br>T·ª± tin v·ªØng b∆∞·ªõc, t√¨nh ca ng·ªçt ng√†o\"" } },
            "e_trung": { group: "member", wish: "Nh√¢n d·ªãp nƒÉm m·ªõi, anh ch√∫c Trung c√≥ th·∫≠t nhi·ªÅu s·ª©c kh·ªèe, h·∫°nh ph√∫c, b√¨nh an, v√† ƒë√°nh \"b√†i\" ƒë√¢u th·∫Øng ƒë√≥ nha üòÖ. Ch√∫c em s·∫Ω c√≥ 1 nƒÉm 2026 b·ª©t ph√°, m·ªçi th·ª© ƒë·ªÅu \"auto\" m∆∞·ª£t m√†, th·ª±c hi·ªán ƒë∆∞·ª£c t·∫•t c·∫£ c√°c d·ª± ƒë·ªãnh, k·∫ø ho·∫°ch c·ªßa c√° nh√¢n c≈©ng nh∆∞ trong c√¥ng vi·ªác, ho√†n th√†nh t·ªët m·ªçi b√†i to√°n/ nhi·ªám v·ª• ƒë∆∞·ª£c giao.", highlightText: "AUTO M∆∞·ª£t M√†", qr: "qr-trung.jpg", fortune: { word: "Th√†nh ƒê·∫°t", content: "<p><b>üìà C√¥ng Danh:</b><br>Vi√™n m√£n v·∫πn to√†n, s·ª± nghi·ªáp thƒÉng hoa b·ª©t ph√° trong nƒÉm m·ªõi.</p><p><b>‚öôÔ∏è Automation:</b><br>Code ch·∫°y 'auto' m∆∞·ª£t m√†, pass m·ªçi case h√≥c b√∫a, kh√¥ng lo g√£y script.</p><p><b>üí™ S·ª©c Kh·ªèe & T√¨nh Duy√™n:</b><br>Th·ªÉ l·ª±c sung m√£n, t√¨nh duy√™n ph∆°i ph·ªõi, r·∫°ng r·ª° n·ª• c∆∞·ªùi.</p>", poem: "\"C√¥ng danh s·ª± nghi·ªáp v∆∞∆°n xa<br>Auto ch·∫°y m∆∞·ª£t, t√¨nh ƒë√† n·ªü hoa\"" } },
            "e_huy": { group: "member", wish: "Nh√¢n d·ªãp nƒÉm m·ªõi, anh ch√∫c Huy c√πng gia ƒë√¨nh nh·ªè c√≥ th·∫≠t nhi·ªÅu s·ª©c kh·ªèe, h·∫°nh ph√∫c v√† b√¨nh an. Ch√∫c em s·∫Ω th·∫≠t tr∆∞·ªüng th√†nh v√† ch·ªØng ch·∫°c ƒë·ªÉ ƒë√≥n nh·∫≠n 1 c∆∞∆°ng v·ªã, vai tr√≤ m·ªõi trong th·ªùi gian t·ªõi nh√© üòä. V·ªõi c√¥ng vi·ªác, anh ch√∫c em s·∫Ω s·ªõm t√¨m ƒë∆∞·ª£c cho b·∫£n th√¢n h∆∞·ªõng ƒëi ph√π h·ª£p v√† ƒë√∫ng ƒë·∫Øn, d√π ·ªü b·∫•t k·ª≥ m√¥i tr∆∞·ªùng n√†o, v·∫´n lu√¥n t·ª± tin, n·ªó l·ª±c v√† g·∫∑t h√°i ƒë∆∞·ª£c nhi·ªÅu th√†nh c√¥ng üí™.", highlightText: "Tr√°ch Nhi·ªám", qr: "qr-huy.jpg", fortune: { word: "V·ªØng B∆∞·ªõc", content: "<p><b>üë®‚Äçüë©‚Äçüëß Gia ƒê√¨nh:</b><br>H·∫°nh ph√∫c vi√™n m√£n, ƒë√≥n nh·∫≠n tin vui.</p><p><b>üíº S·ª± Nghi·ªáp:</b><br>V·ªØng v√†ng, ƒë·ªãnh h∆∞·ªõng r√µ r√†ng, th√†nh c√¥ng ph√≠a tr∆∞·ªõc.</p><p><b>üí™ B·∫£n Lƒ©nh:</b><br>Tr∆∞·ªüng th√†nh, v·ªØng v√†ng tr∆∞·ªõc m·ªçi th·ª≠ th√°ch.</p>", poem: "\"Tr√°ch nhi·ªám tr√™n vai ch√≠ th√™m b·ªÅn<br>Th√†nh c√¥ng g√µ c·ª≠a r·∫°ng t∆∞∆°ng lai\"" } }
        };

        const typeSpeed = 35; let charIndex = 0; let isTypingPart2 = false; let selectedPerson = ""; let treeInitialized = false;
        
        window.onload = function() {
            let idParam = new URLSearchParams(window.location.search).get('id');
            selectedPerson = (idParam && PERSON_DATA[idParam.trim().toLowerCase()]) ? idParam.trim().toLowerCase() : 'e_linh';
            
            // T·ªëi ∆∞u t·∫°o hoa r∆°i li√™n t·ª•c
            flowerInterval = setInterval(createFlower, 450); 
            
            music.play().then(() => { isPlaying = true; updateSoundIcon(true); }).catch(() => { updateSoundIcon(false); });
        };

        function updateSoundIcon(playing) { soundBtn.innerHTML = playing ? 'üîä' : 'üîá'; soundBtn.style.animation = playing ? 'none' : 'pulse-btn 2s infinite'; }
        function toggleSound(event) { event.stopPropagation(); speakerHint.style.display = 'none'; if (music.paused) { music.play(); isPlaying = true; updateSoundIcon(true); } else { music.pause(); isPlaying = false; updateSoundIcon(false); } }
        function playAudioForce() { if (music.paused) { music.play().then(() => { isPlaying = true; updateSoundIcon(true); }).catch((e) => console.log(e)); } }
        
        function openEnvelope() { 
            playAudioForce(); 
            speakerHint.style.display = 'none'; 
            document.getElementById('coupletLeft').style.display = 'none'; 
            document.getElementById('coupletRight').style.display = 'none'; 
            document.getElementById('envelope').style.display = 'none'; 
            document.getElementById('content').style.display = 'block'; 
            
            // TH√äM L·∫†I PH√ÅO HOA KHI V·ª™A M·ªû L√å X√å KH·ªûI ƒê·∫¶U
            createFirework();
            setTimeout(createFirework, 400);
            setTimeout(createFirework, 800);
            
            showImageAndStartGreeting(); 
        }

        function showImageAndStartGreeting() {
            const imgContainer = document.getElementById("extra-image-container"); const greetingImg = document.getElementById("mainImage"); const caption = document.getElementById("imageCaption");
            if (PERSON_DATA[selectedPerson].group === 'boss') { greetingImg.src = 'Anh-1.jpg'; caption.innerText = "Bi·ªát ƒë·ªôi KTCN - Ki·∫øn t·∫°o t∆∞∆°ng lai üöÄ"; } else { greetingImg.src = 'Anh-2.jpg'; caption.innerText = "Bi·ªát ƒê·ªôi SƒÉn Bug - Qu√©t S·∫°ch M·ªçi L·ªói üêõüî´"; }
            imgContainer.style.display = "block"; setTimeout(typeWriter, 500);
        }

        function typeWriter() {
            const container = document.getElementById("type-text"); const pen = document.getElementById("writing-pen");
            const personInfo = PERSON_DATA[selectedPerson] || PERSON_DATA['e_linh']; const textPart1 = personInfo.wish;
            if (!isTypingPart2) {
                if (charIndex < textPart1.length) { container.innerHTML += textPart1.charAt(charIndex); charIndex++; setTimeout(typeWriter, typeSpeed); if(charIndex % 20 === 0) { const contentDiv = document.getElementById('content'); contentDiv.scrollTo({ top: contentDiv.scrollHeight, behavior: 'smooth' }); } } 
                else { isTypingPart2 = true; pen.style.display = "none"; initGameOrShowBoss(); }
            }
        }

        /* --- GAME LOGIC --- */
        let currentSelected = null; let wordOrder = []; let correctOrder = [];
        function initGameOrShowBoss() {
            const data = PERSON_DATA[selectedPerson] || PERSON_DATA['e_linh'];
            const interactiveSection = document.getElementById("interactive-section"); const boardArea = document.getElementById("boardArea");
            const finalTextContainer = document.getElementById("finalTextContainer"); const finalText = document.getElementById("finalText");
            const btnLucky = document.getElementById("btnLucky"); const contentDiv = document.getElementById('content');
            interactiveSection.style.display = "block";
            if (data.group === 'boss') {
                boardArea.style.display = "none"; finalText.innerText = "2026 - " + data.highlightText; finalTextContainer.style.display = "block"; btnLucky.style.display = "block"; setTimeout(() => { contentDiv.scrollTo({ top: contentDiv.scrollHeight, behavior: 'smooth' }); }, 200);
            } else {
                boardArea.style.display = "block"; correctOrder = data.highlightText.split('');
                let letters = correctOrder.filter(c => c !== ' '); let originalLetters = letters.join('');
                shuffleArray(letters); while(letters.join('') === originalLetters && letters.length > 1) { shuffleArray(letters); }
                wordOrder = correctOrder.map(c => c === ' ' ? ' ' : letters.pop()); renderGame(); setTimeout(() => { contentDiv.scrollTo({ top: contentDiv.scrollHeight, behavior: 'smooth' }); }, 200);
            }
        }
        function shuffleArray(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } }
        function renderGame() {
            const container = document.getElementById("wordContainer"); container.innerHTML = ''; 
            wordOrder.forEach((char, index) => {
                if (char === ' ') { const space = document.createElement("div"); space.className = "space-chip"; container.appendChild(space); } else {
                    const chip = document.createElement("div"); chip.className = "letter-chip"; if (index === currentSelected) chip.classList.add("selected");
                    chip.innerText = char; chip.onclick = () => handleWordClick(index); container.appendChild(chip);
                }
            });
        }
        function handleWordClick(index) {
            if (document.getElementById("btnLucky").style.display === "block") return; if (wordOrder[index] === ' ') return;
            if (currentSelected === null) { currentSelected = index; renderGame(); } else {
                if (currentSelected !== index) { let temp = wordOrder[currentSelected]; wordOrder[currentSelected] = wordOrder[index]; wordOrder[index] = temp; currentSelected = null; renderGame(); checkWin(); } 
                else { currentSelected = null; renderGame(); }
            }
        }
        function checkWin() {
            if (wordOrder.join('') === correctOrder.join('')) {
                document.querySelectorAll(".letter-chip").forEach(chip => chip.classList.add("correct"));
                const instr = document.getElementById("gameInstruction"); instr.innerText = "Tuy·ªát v·ªùi! Ch√∫c m·ª´ng em!"; instr.style.color = "#28a745";
                setTimeout(() => {
                    document.getElementById("boardArea").style.display = "none"; const backdrop = document.createElement("div"); backdrop.className = "celebration-backdrop"; document.body.appendChild(backdrop);
                    const fullText = "2026 - " + correctOrder.join(''); const popup = document.createElement("div"); popup.className = "celebration-popup"; popup.innerText = fullText; document.body.appendChild(popup);
                    
                    createFirework(); setTimeout(createFirework, 800); setTimeout(createFirework, 1600); setTimeout(createFirework, 2400);
                    
                    setTimeout(() => {
                        popup.remove(); backdrop.remove(); document.getElementById("finalText").innerText = fullText; document.getElementById("finalTextContainer").style.display = "block";
                        document.getElementById("btnLucky").style.display = "block"; const contentDiv = document.getElementById('content'); contentDiv.scrollTo({ top: contentDiv.scrollHeight, behavior: 'smooth' }); setInterval(createFirework, 1500);
                    }, 3000); 
                }, 800);
            }
        }

        function startShaking() {
            document.getElementById('shakingModal').style.display = 'flex';
            const personInfo = PERSON_DATA[selectedPerson] || PERSON_DATA['e_linh']; const data = personInfo.fortune;
            document.getElementById('fortune-word').innerHTML = data.word || "B√¨nh An";
            document.getElementById('fortune-details').innerHTML = data.content || "<p><b>üçÄ May M·∫Øn:</b><br>M·ªçi s·ª± hanh th√¥ng.</p>";
            document.getElementById('fortune-poem').innerHTML = data.poem || "\"Ph√∫c l·ªôc d·ªìi d√†o v·∫°n s·ª± an\"";
            setTimeout(function() { document.getElementById('shakingModal').style.display = 'none'; document.getElementById('resultModal').style.display = 'flex'; }, 3000);
        }

        /* --- C√ÇY ƒê√ÄO 3D & L√å X√å --- */
        function showTreeOverlay() {
            document.getElementById('resultModal').style.display = 'none'; document.getElementById('content').style.display = 'none';
            document.getElementById('treeOverlay').style.display = 'flex';
            clearInterval(flowerInterval); // D·ª´ng hoa r∆°i ngo√†i m√†n h√¨nh ch√≠nh ƒë·ªÉ ti·∫øt ki·ªám CPU
            if (!treeInitialized) { generateTree(); treeInitialized = true; }
        }

        function generateTree() {
            const canopy = document.getElementById('treeCanopy'); canopy.innerHTML = '';
            
            // Ph√¢n b·ªï khu v·ª±c nh√°nh ch√≠nh ƒë·ªÉ sinh hoa v√† l√° b√°m theo Vector SVG ƒë√£ ƒëi·ªÅu ch·ªânh cƒÉn gi·ªØa
            const zones = [
                {x: 10, y: 10, w: 35, h: 40},   // Nh√°nh Tr√°i
                {x: 55, y: 5, w: 40, h: 35},    // Nh√°nh Ph·∫£i Cao
                {x: 55, y: 35, w: 35, h: 25},   // Nh√°nh Ph·∫£i Th·∫•p
                {x: 35, y: 0, w: 25, h: 40},    // Nh√°nh Gi·ªØa v∆∞∆°n l√™n
                {x: 40, y: 40, w: 20, h: 30}    // G·ªëc c√†nh
            ];

            // R·∫£i 120 hoa v√† l√° 
            for (let i = 0; i < 120; i++) {
                let zone = zones[Math.floor(Math.random() * zones.length)];
                let cx = zone.x + Math.random() * zone.w;
                let cy = zone.y + Math.random() * zone.h;

                const isFlower = Math.random() > 0.35; // 65% hoa, 35% l√°
                let element = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                let useTag = document.createElementNS("http://www.w3.org/2000/svg", "use");
                
                element.style.position = "absolute";
                element.style.left = cx + '%';
                element.style.top = cy + '%';
                element.style.overflow = "visible";
                
                if (isFlower) {
                    element.setAttribute("class", "svg-flower");
                    useTag.setAttribute("href", "#peach-flower");
                    element.style.width = (15 + Math.random()*12) + 'px';
                    element.style.height = element.style.width;
                    element.style.animationDelay = (Math.random() * 3) + 's';
                } else {
                    element.setAttribute("class", "svg-leaf");
                    useTag.setAttribute("href", "#peach-leaf");
                    element.style.width = (12 + Math.random()*6) + 'px';
                    element.style.height = element.style.width;
                    element.style.transform = `rotate(${Math.random()*360}deg)`;
                }
                
                element.appendChild(useTag); canopy.appendChild(element);
            }

            // G·∫Øn 10 bao l√¨ x√¨ b√°m theo c√°c t·ªça ƒë·ªô chu·∫©n m·ªõi c·ªßa c√¢y
            const personInfo = PERSON_DATA[selectedPerson] || PERSON_DATA['e_linh']; const qrImage = personInfo.qr;
            const envPos = [
                [25, 30], [40, 15], [50, 45], // Tr√°i & G·ªëc
                [70, 15], [85, 25], [65, 45], [90, 45], // Ph·∫£i
                [43, 5], [57, 25], [30, 50] // ƒêi·ªÉm xuy·∫øt
            ];
            
            for (let i = 0; i < 10; i++) {
                let wrap = document.createElement('div'); wrap.className = 'tree-envelope-wrapper';
                const pos = envPos[i];
                wrap.style.left = pos[0] + '%';
                wrap.style.top = pos[1] + '%';
                wrap.style.animationDelay = (Math.random() * 2) + 's';
                
                wrap.innerHTML = `<div class="env-string"></div><div class="tree-envelope"><div class="epass-logo">ePass</div><div class="qr-pop-out"><img src="${qrImage}" style="width:100%;height:100%; object-fit: cover;"></div></div>`;
                
                let envBox = wrap.querySelector('.tree-envelope');
                envBox.onclick = function(e) { e.stopPropagation(); pickEnvelope(this, qrImage); };
                canopy.appendChild(wrap);
            }
        }

        function pickEnvelope(envBox, qrImage) {
            let wrapElement = envBox.parentElement;
            if (wrapElement.classList.contains('opened')) return; wrapElement.classList.add('opened'); 
            
            const rect = envBox.getBoundingClientRect();
            
            const cloneWrap = document.createElement('div'); cloneWrap.className = 'env-clone-wrap';
            cloneWrap.style.position = 'fixed'; cloneWrap.style.top = rect.top + 'px'; cloneWrap.style.left = rect.left + 'px';
            
            cloneWrap.innerHTML = `<div class="env-clone"><div class="epass-logo">ePass</div><div class="qr-pop-out"><img src="${qrImage}" style="width:100%;height:100%; object-fit: cover; border-radius: 2px;"></div></div>`;
            
            document.body.appendChild(cloneWrap); wrapElement.style.opacity = '0';
            
            void cloneWrap.offsetWidth; cloneWrap.classList.add('fly-and-open');
            setTimeout(() => { document.getElementById('treeOverlay').style.display = 'none'; showQRModalReal(qrImage); cloneWrap.remove(); }, 2100); 
        }

        /* --- X·ª¨ L√ù QR & HI·ªÜU ·ª®NG CHUNG --- */
        function showQRModalReal(qrImageSrc) {
            const personInfo = PERSON_DATA[selectedPerson] || PERSON_DATA['e_linh']; const group = personInfo.group;
            const qrTitle = document.getElementById('qrTitle'); const qrImgMain = document.getElementById('qrImgMain'); const finalMsg = document.getElementById('finalMsg');
            qrImgMain.src = qrImageSrc;
            if (group === 'boss') { qrTitle.innerText = "Khai Xu√¢n ƒê·∫Øc L·ªôc"; finalMsg.innerText = "Tuy gi√° tr·ªã l√¨ x√¨ kh√¥ng l·ªõn, nh∆∞ng ƒë√¢y l√† t·∫•m l√≤ng c·ªßa em g·ª≠i t·ªõi Anh nh√¢n d·ªãp ƒë·∫ßu xu√¢n nƒÉm m·ªõi. K√≠nh ch√∫c Anh m·ªôt nƒÉm B√≠nh Ng·ªç 2026 th·∫≠t nhi·ªÅu s·ª©c kh·ªèe, h·∫°nh ph√∫c v√† th√†nh c√¥ng r·ª±c r·ª°! üòä"; } 
            else { qrTitle.innerText = "May m·∫Øn ƒë·∫ßu xu√¢n"; finalMsg.innerText = "Tuy gi√° tr·ªã l√¨ x√¨ kh√¥ng l·ªõn, nh∆∞ng hy v·ªçng n√≥ s·∫Ω mang l·∫°i cho em ch√∫t ni·ªÅm vui v√† may m·∫Øn trong ng√†y ƒë·∫ßu nƒÉm üòâ"; }
            document.getElementById('qrOverlay').style.display = 'flex';
        }
        function forceDownloadQR() {
            const imgSrc = document.getElementById('qrImgMain').src;
            fetch(imgSrc).then(resp => resp.blob()).then(blob => {
                const url = window.URL.createObjectURL(blob); const a = document.createElement('a'); a.style.display = 'none'; a.href = url; a.download = 'LiXi_Tet_2026.jpg'; document.body.appendChild(a); a.click(); window.URL.revokeObjectURL(url);
            }).catch(() => { const a = document.createElement('a'); a.href = imgSrc; a.download = 'LiXi_Tet_2026.jpg'; a.click(); });
        }
        function closeQR() { document.getElementById('qrOverlay').style.display = 'none'; document.getElementById('content').style.display = 'block'; }
        function openLightbox(imgSrc) { document.getElementById("lightboxImg").src = imgSrc; document.getElementById("qrLightbox").style.display = "flex"; }
        function closeLightbox() { document.getElementById("qrLightbox").style.display = "none"; }
        
        // T·ªëi ∆∞u t·∫°o hoa r∆°i b·∫±ng CSS Variable (kh√¥ng append DOM style li√™n t·ª•c)
        function createFlower() {
            const flower = document.createElement('div'); flower.className = 'flower'; flower.innerHTML = Math.random() > 0.5 ? 'üå∏' : 'üåº'; 
            flower.style.left = Math.random() * 100 + 'vw'; flower.style.fontSize = (Math.random() * 20 + 10) + 'px';
            const duration = Math.random() * 5 + 5; 
            flower.style.setProperty('--fall-rot', Math.random() * 360 + 'deg');
            flower.style.animation = `fall ${duration}s linear forwards`;
            document.body.appendChild(flower);
            setTimeout(() => { flower.remove(); }, duration * 1000);
        }

        // T·ªëi ∆∞u ph√°o hoa (D√πng CSS Variable ƒë·ªÉ ƒë·ª° Repaint)
        function createFirework() {
            const shell = document.createElement('div'); shell.className = 'firework-shell'; shell.style.left = Math.random() * 90 + 5 + 'vw'; shell.style.top = Math.random() * 60 + 10 + 'vh'; document.body.appendChild(shell);
            const colors = ['#ff0000', '#ffff00', '#00ff00', '#00ffff', '#ff00ff', '#ffaa00', '#ffffff']; const color = colors[Math.floor(Math.random() * colors.length)];
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div'); particle.className = 'firework-particle'; particle.style.backgroundColor = color;
                const size = Math.random() * 3 + 2 + 'px'; particle.style.width = size; particle.style.height = size;
                particle.style.boxShadow = `0 0 10px ${color}, 0 0 20px ${color}`;
                const angle = (i / 50) * 360 * (Math.PI / 180); const distance = Math.random() * 200 + 50;
                const x = Math.cos(angle) * distance + 'px'; const y = Math.sin(angle) * distance + 'px';
                particle.style.setProperty('--x', x); particle.style.setProperty('--y', y); shell.appendChild(particle);
            }
            setTimeout(() => { shell.remove(); }, 1200);
        }
    </script>
</body>
</html>
