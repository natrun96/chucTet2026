<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gieo Quáº» Äáº§u NÄƒm 2026</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ§§</text></svg>">
    
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:ital,wght@0,400;0,600;0,700;0,800;1,400;1,600&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    
    <style>
        /* ==========================================================
           1. Cáº¤U HÃŒNH CHUNG & Tá»I Æ¯U HIá»†U NÄ‚NG
           ========================================================== */
        body { margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; height: 100dvh; background: linear-gradient(135deg, #8a0000 0%, #ff1a1a 100%); font-family: 'Be Vietnam Pro', sans-serif; overflow: hidden; text-align: center; color: white; }
        
        /* Ngá»±a Phi */
        .horse-container { position: absolute; bottom: 15px; left: -300px; z-index: 5; pointer-events: none; display: flex; gap: -20px; animation: runAcross 7s linear infinite; will-change: transform; }
        .horse-unit { font-size: 80px; display: inline-block; transform: scaleX(-1); filter: drop-shadow(5px 5px 5px rgba(0,0,0,0.5)); will-change: transform; }
        .galloping { animation: gallop 0.6s ease-in-out infinite alternate; }
        .horse-red { filter: hue-rotate(-50deg) saturate(2) drop-shadow(5px 5px 5px rgba(0,0,0,0.5)); }
        .horse-gold { filter: hue-rotate(45deg) saturate(3) brightness(1.2) drop-shadow(5px 5px 5px rgba(0,0,0,0.5)); animation-delay: 0.1s; }
        .horse-brown { animation-delay: 0.2s; }
        @keyframes runAcross { 0% { transform: translateX(0); } 100% { transform: translateX(calc(100vw + 500px)); } }
        @keyframes gallop { 0% { transform: scaleX(-1) translateY(0) rotate(0deg); } 100% { transform: scaleX(-1) translateY(-20px) rotate(5deg); } }

        /* NÃºt Loa & Gá»£i Ã½ */
        .sound-control { position: fixed; top: 20px; right: 20px; width: 25px; height: 25px; background: rgba(0, 0, 0, 0.6); border: 2px solid #ffd700; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 18px; cursor: pointer; z-index: 200; transition: transform 0.2s; animation: pulse-btn 2s infinite; }
        .speaker-hint { position: fixed; top: 20px; right: 50px; z-index: 200; color: #fff; font-size: 12px; font-weight: 700; background: #d00000; padding: 2px 5px; border-radius: 40px; border: 1px solid #ffd700; box-shadow: 0 0 10px rgba(255, 215, 0, 0.8); pointer-events: none; display: flex; align-items: center; gap: 5px; animation: hint-bounce 1s infinite alternate; white-space: nowrap; }
        .speaker-hint::after { content: 'â¡ï¸'; font-size: 18px; }
        @keyframes hint-bounce { 0% { transform: translateX(0); } 100% { transform: translateX(-5px); } }
        @keyframes pulse-btn { 0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(255, 215, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); } }

        /* Bao LÃ¬ XÃ¬ Khá»Ÿi Äáº§u */
        #envelope { width: 300px; height: 450px; background: linear-gradient(to bottom, #b30000, #e60000); border: 4px solid #ffd700; border-radius: 20px; cursor: pointer; display: flex; flex-direction: column; justify-content: center; align-items: center; box-shadow: 0 10px 50px rgba(0,0,0,0.7); transition: transform 0.3s; z-index: 20; position: relative; margin-bottom: 80px; }
        #envelope:hover { transform: scale(1.05); }
        .envelope-icon { font-size: 80px; margin-bottom: -10px; filter: drop-shadow(0 4px 4px rgba(0,0,0,0.3)); }
        .year-text { font-size: 35px; font-weight: 800; color: #ffd700; text-shadow: 3px 3px 0px #8b0000; font-family: 'Be Vietnam Pro', sans-serif; margin-bottom: 10px; }
        .click-hint { font-size: 16px; font-weight: 700; margin-top: 20px; animation: blink 1.5s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }

        /* CÃ¢u Äá»‘i */
        .couplet { position: fixed; top: 50%; width: 45px; background: linear-gradient(to bottom, #b30000, #990000); border: 3px solid #ffd700; border-radius: 4px; color: #ffd700; font-family: 'Times New Roman', serif; font-weight: 900; text-align: center; padding: 15px 0; box-shadow: 4px 4px 15px rgba(0,0,0,0.5), inset 0 0 10px rgba(0,0,0,0.3); z-index: 5; display: flex; flex-direction: column; align-items: center; gap: 6px; animation: floatCouplet 3s ease-in-out infinite alternate; will-change: transform; }
        .couplet-left { left: 8px; } .couplet-right { right: 8px; animation-delay: -1.5s; }
        .couplet span { display: block; font-size: 13px; line-height: 1.2; text-shadow: 1px 1px 2px rgba(0,0,0,0.6); width: 100%; white-space: nowrap; }
        .couplet-cap-top, .couplet-cap-bottom { position: absolute; left: 50%; transform: translateX(-50%); width: 55px; height: 8px; background: linear-gradient(to right, #ffd700, #e6c300, #ffd700); border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .couplet-cap-top { top: -5px; } .couplet-cap-bottom { bottom: -5px; }
        @keyframes floatCouplet { 0% { transform: translateY(calc(-50% - 10px)); } 100% { transform: translateY(calc(-50% + 10px)); } }

        /* ==========================================================
           2. Ná»˜I DUNG Lá»œI CHÃšC & GAME
           ========================================================== */
        #content { display: none; background: #fffaf0; padding: 25px 20px; border-radius: 20px; box-shadow: 0 0 60px rgba(255, 204, 0, 0.9); width: 360px; max-width: 90%; border: 3px solid #d41414; position: relative; z-index: 20; margin-bottom: 10px; max-height: 85dvh; overflow-y: auto; scroll-behavior: smooth; }
        @keyframes popIn { 0% { opacity: 0; transform: scale(0.5); } 100% { opacity: 1; transform: scale(1); } }
        h1.title-tet { color: #d00000; font-size: 24px; font-weight: 800; margin-bottom: 5px; margin-top: 0px;}
        .horse-icons-top { font-size: 28px; margin: 0px 0 10px 0; }
        .wishes { font-size: 15.5px; line-height: 1.65; color: #333; font-style: italic; font-weight: 600; background: #fff; padding: 15px; border-radius: 10px; border: 1px dashed #d00000; margin-bottom: 15px; text-align: left; }
        .writing-pen { display: inline-block; font-size: 20px; margin-left: 5px; animation: write-move 0.3s infinite alternate; }
        @keyframes write-move { 0% { transform: rotate(0deg) translateY(0); } 100% { transform: rotate(15deg) translateY(-5px); } }
        #extra-image-container { display: none; margin-bottom: 15px; text-align: center;}
        .my-custom-img { width: 100%; max-width: 100%; border-radius: 10px; border: 3px solid #d00000; box-shadow: 0 5px 15px rgba(0,0,0,0.2); display: block; margin: 0 auto; cursor: zoom-in; opacity: 0; filter: blur(20px) brightness(1.2); transform: scale(1.1); animation: cinematicReveal 1.5s ease-out forwards; }
        .image-caption { margin-top: 8px; font-size: 14px; font-weight: 700; color: #b30000; text-shadow: 1px 1px 0px rgba(255,255,255,0.8); font-style: italic; opacity: 0; animation: fadeIn 1s ease-out forwards; animation-delay: 1s; }
        @keyframes cinematicReveal { 0% { opacity: 0; filter: blur(20px) brightness(1.5); transform: scale(1.15); } 50% { opacity: 0.8; filter: blur(5px) brightness(1.1); } 100% { opacity: 1; filter: blur(0) brightness(1); transform: scale(1); } }

        /* GAME CHá»® & NÃšT */
        #interactive-section { border-top: 1px dashed #d00000; padding-top: 15px; margin-top: 15px; }
        .year-label { display: block; text-align: center; font-size: 22px; font-weight: 800; color: #d00000; margin-top: 0px; margin-bottom: 10px; }
        .scramble-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 4px; margin-bottom: 5px; padding: 0; }
        .letter-chip { background: linear-gradient(to bottom, #ffd700, #fdb931); color: #d00000; font-weight: 800; font-size: 16px; padding: 5px 8px; border-radius: 6px; border: 1px solid #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.2); cursor: pointer; user-select: none; transition: all 0.2s; display: flex; justify-content: center; align-items: center; min-width: 14px; text-align: center; }
        .letter-chip.selected { border: 1px solid #d00000; background: #fff; color: #d00000; transform: scale(1.15) translateY(-3px); box-shadow: 0 4px 8px rgba(0,0,0,0.3); z-index: 10; }
        .letter-chip.correct { background: #28a745 !important; color: white !important; border-color: #fff !important; cursor: default; animation: popSuccess 0.5s forwards; }
        @keyframes popSuccess { 50% { transform: scale(1.15); background: #20c997; } 100% { transform: scale(1); } }
        
        .space-chip { width: 6px; } 
        .dash-chip { font-weight: bold; color: #d00000; display: flex; align-items: center; justify-content: center; margin: 0 2px; }
        .scramble-container.long-text .letter-chip { font-size: 13px; padding: 4px 6px; min-width: 10px; margin-bottom: 2px; }

        .game-instruction { font-size: 13px; font-style: italic; color: #666; margin-top: 12px; margin-bottom: 10px; animation: blink 2s infinite; padding: 0; text-align: center; display: block; }
        .celebration-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.75); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); z-index: 9998; opacity: 0; animation: fadeInOutBackdrop 3s ease-in-out forwards; }
        @keyframes fadeInOutBackdrop { 0% { opacity: 0; } 10% { opacity: 1; } 85% { opacity: 1; } 100% { opacity: 0; } }
        .celebration-popup { position: fixed; top: 50%; left: 50%; width: 100%; text-align: center; transform: translate(-50%, -50%) scale(0); font-size: 34px; font-weight: 800; color: #ffd700; text-shadow: 0 0 20px #ff0000, 2px 2px 0px #8b0000, -2px -2px 0px #8b0000; z-index: 9999; pointer-events: none; animation: zoomPopCenter 3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; line-height: 1.4;}
        @keyframes zoomPopCenter { 0% { transform: translate(-50%, -50%) scale(0); opacity: 0; } 15% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; } 85% { transform: translate(-50%, -50%) scale(1); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(0.2); opacity: 0; } }
        .static-highlight { display: block; text-align: center; font-size: 24px; font-weight: 800; color: #d00000; text-shadow: 1px 1px 0px rgba(255,255,255,0.5); margin-top: 5px; margin-bottom: 20px; animation: popIn 0.5s; text-wrap: balance; }
        .btn-lucky { display: none; padding: 12px 30px; margin: 0 auto; background: linear-gradient(to right, #ffd700, #fdb931); color: #d00000; font-weight: 800; border-radius: 50px; border: 2px solid #fff; cursor: pointer; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.5); font-size: 16px; transition: transform 0.2s; animation: pulse-gold 1.5s infinite; }
        @keyframes pulse-gold { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); } 50% { transform: scale(1.05); box-shadow: 0 0 0 15px rgba(255, 215, 0, 0); } 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); } }

        /* --- XIN KEO & TRáº¢ QUáºº --- */
        #shakingModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 3000; justify-content: center; align-items: center; flex-direction: column; }
        .fortune-container { width: 100px; height: 160px; background: linear-gradient(to right, #b30000, #d00000, #b30000); border: 4px solid #ffd700; border-radius: 10px 10px 30px 30px; position: relative; animation: shake-hard 0.4s ease-in-out infinite; box-shadow: 0 10px 30px rgba(0,0,0,0.6); }
        .fortune-container::before { content: ''; position: absolute; top: -15px; left: 5px; width: 82px; height: 25px; background: #800000; border: 4px solid #ffd700; border-radius: 50%; z-index: 2; }
        .sticks-bundle { position: absolute; top: -40px; left: 20px; width: 60px; height: 60px; z-index: 1; }
        .stick-sample { position: absolute; width: 10px; height: 80px; background: #f0e68c; border-radius: 5px; border: 1px solid #d4a017; }
        .stick-sample:nth-child(1) { left: 10px; transform: rotate(-15deg); top: 10px; } .stick-sample:nth-child(2) { left: 25px; transform: rotate(0deg); top: 0px; } .stick-sample:nth-child(3) { left: 40px; transform: rotate(15deg); top: 10px; }
        @keyframes shake-hard { 0% { transform: rotate(0deg) translateY(0); } 25% { transform: rotate(-10deg) translateY(-10px); } 50% { transform: rotate(0deg) translateY(0); } 75% { transform: rotate(10deg) translateY(10px); } 100% { transform: rotate(0deg) translateY(0); } }
        .shaking-text { color: #ffd700; font-size: 22px; font-weight: 700; margin-top: 40px; text-shadow: 0 0 10px #d00000; animation: blink 1s infinite; }
        
        #resultModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 3000; justify-content: center; align-items: center; animation: fadeIn 0.3s; }
        .bamboo-card { width: 300px; min-height: 450px; background: #fdf5e6; border: 8px solid #d4a017; border-radius: 15px; position: relative; display: flex; flex-direction: column; align-items: center; padding: 0; box-shadow: 0 0 50px rgba(255, 215, 0, 0.5); transform: scale(0.1); opacity: 0; animation: card-reveal 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; overflow: hidden; }
        .card-header { width: 100%; height: 70px; background: #d00000; display: flex; justify-content: center; align-items: center; color: #ffd700; font-size: 32px; font-weight: 800; border-bottom: 4px solid #d4a017; text-transform: uppercase; }
        .card-body { padding: 20px; width: 100%; box-sizing: border-box; text-align: center; color: #5c4033; background-image: linear-gradient(#fdf5e6 1px, transparent 1px), linear-gradient(90deg, #fdf5e6 1px, transparent 1px); background-size: 20px 20px; }
        .fortune-rank { display: inline-block; font-size: 36px; font-weight: 900; font-family: 'Dancing Script', cursive, sans-serif; background: linear-gradient(to right, #d00000, #ff0000); -webkit-background-clip: text; -webkit-text-fill-color: transparent; border: 2px solid #d00000; padding: 5px 25px; border-radius: 50px; margin-bottom: 15px; white-space: nowrap; animation: text-blink 1.5s infinite alternate; }
        @keyframes text-blink { 0% { opacity: 1; filter: drop-shadow(0 0 5px rgba(255, 0, 0, 0.8)); transform: scale(1); } 100% { opacity: 0.6; filter: drop-shadow(0 0 0px rgba(255, 0, 0, 0)); transform: scale(1.02); } }
        .fortune-content p { font-size: 14px; line-height: 1.45; margin: 10px 0; font-weight: 600; border-bottom: 1px dashed #ccc; padding-bottom: 5px; text-wrap: balance; }
        .fortune-content b { color: #d00000; font-size: 16px; font-weight: 800; }
        .poem { margin-top: 15px; font-style: italic; color: #800000; font-weight: 700; font-size: 15px; text-wrap: balance; }
        .btn-get-money-card { margin-top: auto; margin-bottom: 20px; background: linear-gradient(to right, #d00000, #ff0000); color: #fff; border: none; padding: 12px 30px; border-radius: 50px; cursor: pointer; font-weight: 800; box-shadow: 0 4px 10px rgba(0,0,0,0.3); font-size: 16px; animation: pulse-gold 1.5s infinite; }
        @keyframes card-reveal { 0% { transform: translateY(200px) scale(0.5); opacity: 0; } 100% { transform: translateY(0) scale(1); opacity: 1; } }

        /* ==========================================================
           3. GIAO DIá»†N HÃI Lá»˜C CÃ‚Y ÄÃ€O 3D (ÄÃƒ Tá»I Æ¯U CÄ‚N CHá»ˆNH)
           ========================================================== */
        #treeOverlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 4000;
            overflow: hidden; animation: fadeIn 0.8s;
            background: linear-gradient(to bottom, #7EC8E3 0%, #E0F7FA 30%, #FFF0F5 70%, #C1E1C1 100%);
            background-image: radial-gradient(circle at 20% 25%, rgba(255,255,255,0.7) 0%, transparent 25%), 
                              radial-gradient(circle at 80% 40%, rgba(255,240,200,0.5) 0%, transparent 30%);
        }
        
        /* Cá» non */
        #treeOverlay::after { 
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 15vh; 
            background: linear-gradient(to top, #2d5a27, #5c9955); 
            clip-path: ellipse(150% 100% at 50% 100%); z-index: 1; pointer-events: none;
        }

        /* TIÃŠU Äá»€: CÄƒn giá»¯a tuyá»‡t Ä‘á»‘i trÃªn cÃ¹ng mÃ n hÃ¬nh */
        .tree-title { 
            position: absolute; top: 4vh; left: 0; width: 100%; text-align: center;
            color: #d41414; font-size: 38px; font-weight: 900; 
            text-shadow: 2px 2px 0px #fff, 0 0 15px rgba(255,255,255,0.9); 
            font-family: 'Dancing Script', cursive; animation: pulse-gold 2s infinite; z-index: 10; pointer-events: none;
        }

        /* KHUNG CHá»¨A TOÃ€N Bá»˜ CÃ‚Y VÃ€ CHáº¬U */
        .tree-area {
            position: absolute; bottom: 5vh; left: 50%; transform: translateX(-50%);
            width: 100vw; min-width: 600px; max-width: 900px; /* Kiá»ƒm soÃ¡t Ä‘á»™ vÆ°Æ¡n cá»§a cÃ nh trÃªn mobile */
            height: 70vh; max-height: 800px;
            display: flex; flex-direction: column; align-items: center; justify-content: flex-end;
            z-index: 2;
        }

        /* CHI TIáº¾T CHáº¬U HOA 3D (Z-index xen káº½) */
        .pot-lip-back { position: absolute; bottom: 95px; left: 50%; transform: translateX(-50%); width: 150px; height: 22px; background: #6b2f15; border-radius: 50%; z-index: 1; }
        .pot-soil { position: absolute; bottom: 93px; left: 50%; transform: translateX(-50%); width: 135px; height: 16px; background: #2b1408; border-radius: 50%; z-index: 2; box-shadow: inset 0 0 10px rgba(0,0,0,0.8);}
        .pot-lip-front { position: absolute; bottom: 85px; left: 50%; transform: translateX(-50%); width: 160px; height: 26px; background: linear-gradient(to right, #a0522d, #d2691e, #a0522d); border-radius: 50%; z-index: 4; box-shadow: 0 4px 6px rgba(0,0,0,0.4), inset 0 2px 2px rgba(255,255,255,0.2); }
        .pot-body { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 130px; height: 95px; background: linear-gradient(to right, #703311, #b34d10, #703311); border-radius: 10px 10px 65px 65px; z-index: 4; display: flex; justify-content: center; align-items: center; box-shadow: inset -15px -10px 20px rgba(0,0,0,0.5), 0 20px 25px rgba(0,0,0,0.6); }
        .pot-body::after { content: '2026'; color: #ffd700; font-size: 26px; font-weight: 900; font-family: 'Arial Black', sans-serif; text-shadow: -1px -1px 0 #cc9900, 2px 2px 3px rgba(0,0,0,0.6); margin-top: 10px;}

        /* CÃ‚Y ÄÃ€O SVG (Cáº¯m vÃ o chÃ­nh giá»¯a Ä‘áº¥t) */
        .tree-svg-container, .tree-canopy {
            position: absolute; bottom: 90px; 
            width: 100%; height: calc(100% - 90px);
            pointer-events: none;
        }
        .tree-svg-container { z-index: 3; }
        .tree-canopy { z-index: 5; }
        .tree-svg-container svg { width: 100%; height: 100%; display: block; overflow: visible; filter: drop-shadow(3px 15px 10px rgba(0,0,0,0.3)); }

        /* HOA ÄÃ€O & LÃ (Sinh báº±ng JS) */
        .svg-flower, .svg-leaf { position: absolute; filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2)); transform-origin: center; will-change: transform; }
        .svg-flower { animation: blossom-pulse 3s infinite alternate; }
        @keyframes blossom-pulse { 0% { transform: scale(0.9); } 100% { transform: scale(1.15); } }

        /* MÆ¯A HOA ÄÃ€O RÆ I TRONG MÃ€N HÃŒNH CÃ‚Y */
        .tree-falling-petal { position: absolute; top: -5vh; z-index: 8; pointer-events: none; will-change: transform, top, left; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));}
        @keyframes tree-fall { to { transform: translateY(110vh) rotate(var(--fall-rot)) translateX(var(--fall-drift)); opacity: 0; } }

        /* LÃŒ XÃŒ TREO TRÃŠN CÃ‚Y */
        .tree-envelope-wrapper { position: absolute; display: flex; flex-direction: column; align-items: center; z-index: 20; transform-origin: top center; pointer-events: auto; animation: env-swing 3s ease-in-out infinite alternate; cursor: pointer; will-change: transform;}
        .env-string { width: 2px; height: 25px; background: #ffd700; box-shadow: 0 0 2px rgba(0,0,0,0.5); }
        .tree-envelope { width: 32px; height: 48px; background: linear-gradient(135deg, #d00000, #ff1a1a); border: 2px solid #ffd700; border-radius: 4px; display: flex; justify-content: center; align-items: center; position: relative; box-shadow: 0 5px 15px rgba(255,0,0,0.4); transition: transform 0.2s; animation: env-blink 1.5s infinite alternate;}
        .tree-envelope-wrapper:hover { animation: none; z-index: 30; transform: scale(1.2); }
        .tree-envelope-wrapper:hover .tree-envelope { box-shadow: 0 0 20px #ffd700; }
        .tree-envelope::before { content: ''; position: absolute; top: -2px; left: -2px; border-left: 16px solid transparent; border-right: 16px solid transparent; border-top: 14px solid #b30000; pointer-events: none; }
        .epass-logo { color: #ffaa00; font-weight: 800; font-size: 8px; text-shadow: 1px 1px 0px #5a0000; transform: rotate(-10deg); pointer-events: none; }
        
        @keyframes env-swing { 0% { transform: rotate(-6deg); } 100% { transform: rotate(6deg); } }
        @keyframes env-blink { 0% { box-shadow: 0 0 5px #ffd700; } 100% { box-shadow: 0 0 15px #ffd700, 0 0 20px rgba(255,0,0,0.6); } }

        /* LÃŒ XÃŒ CLONE BAY RA MÃ€N HÃŒNH */
        .env-clone-wrap { width: 34px; height: 50px; z-index: 9999; display: flex; flex-direction: column; align-items: center; transition: all 1s cubic-bezier(0.25, 0.1, 0.25, 1); transform-origin: center; will-change: transform, top, left;}
        .env-clone { width: 100%; height: 100%; background: linear-gradient(135deg, #d00000, #ff1a1a); border: 2px solid #ffd700; border-radius: 4px; display: flex; justify-content: center; align-items: center; box-shadow: 0 10px 30px rgba(0,0,0,0.8); position: relative; }
        .env-clone::before { content: ''; position: absolute; top: -2px; left: -2px; border-left: 17px solid transparent; border-right: 17px solid transparent; border-top: 15px solid #b30000; transition: transform 0.6s; transform-origin: top; z-index: 2; }
        .env-clone .epass-logo { color: #ffaa00; font-weight: 800; font-size: 9px; text-shadow: 1px 1px 0px #5a0000; transform: rotate(-10deg); z-index: 3; transition: opacity 0.3s;}
        .qr-pop-out { position: absolute; width: 28px; height: 28px; background: white; z-index: 1; opacity: 0; transition: all 0.6s ease-out; padding: 2px; border: 1px solid #ccc; border-radius: 2px;}
        
        .env-clone-wrap.fly-and-open { top: 50% !important; left: 50% !important; transform: translate(-50%, -50%) scale(6); }
        .env-clone-wrap.fly-and-open .env-clone::before { transform: rotateX(180deg); transition-delay: 1s; opacity: 0; }
        .env-clone-wrap.fly-and-open .epass-logo { opacity: 0; transition-delay: 1s; }
        .env-clone-wrap.fly-and-open .qr-pop-out { opacity: 1; transform: translateY(-38px); transition-delay: 1.2s; box-shadow: 0 5px 10px rgba(0,0,0,0.5); }

        /* ==========================================================
           4. POPUP QR CUá»I CÃ™NG & HIá»†U á»¨NG Ná»€N
           ========================================================== */
        #qrOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(50, 0, 0, 0.85); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); z-index: 5000; justify-content: center; align-items: center; flex-direction: column; animation: fadeIn 0.8s; overflow-y: auto; padding: 20px 0; }
        .btn-close-qr { position: absolute; top: 30px; right: 30px; color: #fff; font-size: 40px; cursor: pointer; opacity: 0.8; transition: 0.3s; text-shadow: 0 0 10px rgba(0,0,0,0.5); z-index: 2005; }
        .btn-close-qr:hover { opacity: 1; transform: scale(1.1); }
        .qr-title-large { color: #ffd700; font-size: 28px; font-weight: bold; margin-bottom: 10px; letter-spacing: 1px; text-shadow: 2px 2px 4px rgba(0,0,0,0.6); margin-top: 50px; }
        .qr-note-top { color: #fff; font-style: italic; font-size: 15px; margin-bottom: 15px; text-shadow: 1px 1px 2px rgba(0,0,0,0.8); text-align: center; line-height: 1.4; padding: 0 20px; }
        
        /* ÄÃ£ tá»‘i Æ°u CSS Ä‘á»ƒ Zalo cho phÃ©p táº£i áº£nh QR khi giá»¯ lÃ¢u */
        .qr-img-large { width: 260px; height: 260px; border: 5px solid #ffd700; border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); background: white; margin-bottom: 20px; transition: transform 0.2s; -webkit-touch-callout: default; -webkit-user-select: auto; user-select: auto; pointer-events: auto; }
        .qr-img-large:hover { transform: scale(1.02); }
        
        #qrLightbox { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9999; justify-content: center; align-items: center; flex-direction: column; animation: fadeIn 0.3s; }
        .lightbox-img-content { width: auto; height: auto; max-width: 90%; max-height: 80vh; border: 3px solid #ffd700; border-radius: 10px; box-shadow: 0 0 30px rgba(255, 215, 0, 0.5); background-color: #fff; animation: zoomInPopup 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); cursor: zoom-out; }
        @keyframes zoomInPopup { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .lightbox-hint-text { color: #ccc; margin-top: 15px; font-style: italic; font-size: 14px; animation: blink 2s infinite; }
        .btn-download-bottom { display: flex; align-items: center; gap: 10px; padding: 10px 25px; background: #d00000; border: 2px solid #ffd700; color: #ffd700; border-radius: 50px; text-decoration: none; font-weight: 800; font-size: 16px; transition: 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.3); cursor: pointer; }
        .btn-download-bottom:hover { transform: scale(1.05); background: #b30000; }
        .final-message { margin-top: 25px; margin-bottom: 50px; font-style: italic; color: #fff; font-size: 15px; max-width: 85%; line-height: 1.6; text-shadow: 0 1px 2px rgba(0,0,0,0.8); background: rgba(0, 0, 0, 0.4); border: 1px dashed #ffd700; padding: 15px 20px; border-radius: 15px; opacity: 0; animation: fadeMsg 2s ease-in-out forwards; animation-delay: 0.5s; }
        @keyframes fadeMsg { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Hoa rÆ¡i ná»n ngoÃ i (ÄÃ£ tÄƒng z-index Ä‘á»ƒ phá»§ lÃªn mÃ n QR) */
        .flower { position: absolute; top: -10vh; z-index: 5001; pointer-events: none; opacity: 0.8; will-change: transform; }
        @keyframes fall { to { transform: translateY(110vh) rotate(var(--fall-rot)); } }

        /* PhÃ¡o Hoa */
        .firework-shell { position: absolute; pointer-events: none; z-index: 10000; }
        .firework-particle { position: absolute; border-radius: 50%; animation: realistic-burst 1.2s ease-out forwards; will-change: transform, opacity; }
        @keyframes realistic-burst { 0% { transform: translate(0, 0) scale(1); opacity: 1; } 60% { transform: translate(var(--x), var(--y)) scale(0.8); opacity: 0.8; } 100% { transform: translate(var(--x), calc(var(--y) + 80px)) scale(0.4); opacity: 0; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body onclick="playAudioForce()">

    <svg style="display: none;">
        <defs>
            <g id="peach-flower">
                <circle cx="0" cy="-6" r="5.5" fill="#ff99b3"/>
                <circle cx="5.5" cy="-1.5" r="5.5" fill="#ff99b3"/>
                <circle cx="3.5" cy="5" r="5.5" fill="#ff99b3"/>
                <circle cx="-3.5" cy="5" r="5.5" fill="#ff99b3"/>
                <circle cx="-5.5" cy="-1.5" r="5.5" fill="#ff99b3"/>
                <circle cx="0" cy="0" r="3" fill="#ff3366"/>
                <circle cx="0" cy="0" r="1.5" fill="#ffd700"/>
            </g>
            <g id="peach-leaf">
                <path d="M0,0 Q8,-8 15,0 Q8,8 0,0" fill="#4caf50" stroke="#2e7d32" stroke-width="0.5"/>
            </g>
        </defs>
    </svg>

    <div class="couplet couplet-left" id="coupletLeft"><div class="couplet-cap-top"></div><span>Váº N</span><span>Sá»°</span><span>NHÆ¯</span><span>Ã</span><div class="couplet-cap-bottom"></div></div>
    <div class="couplet couplet-right" id="coupletRight"><div class="couplet-cap-top"></div><span>AN</span><span>KHANG</span><span>THá»ŠNH</span><span>VÆ¯á»¢NG</span><div class="couplet-cap-bottom"></div></div>
    <div class="horse-container"><div class="horse-unit horse-red galloping">ğŸ</div><div class="horse-unit horse-gold galloping">ğŸ</div><div class="horse-unit horse-brown galloping">ğŸ</div></div>

    <div id="envelope" onclick="openEnvelope()">
        <div class="envelope-icon">ğŸ§§</div><div class="year-text">XuÃ¢n BÃ­nh Ngá»<br>2026</div><div class="click-hint">Xin má»i áº¥n vÃ o Ä‘Ã¢y ğŸ˜</div>
    </div>

    <div id="content">
        <h1 class="title-tet">ChÃºc Má»«ng NÄƒm Má»›i<br>XuÃ¢n BÃ­nh Ngá» 2026!</h1><div class="horse-icons-top">ğŸ ğŸ ğŸ</div>
        <div id="extra-image-container"><img src="" id="mainImage" class="my-custom-img" onclick="openLightbox(this.src)"><div id="imageCaption" class="image-caption"></div></div>
        <div class="wishes">
            <span id="type-text"></span><span id="writing-pen" class="writing-pen">ğŸ–Œï¸</span>
            <div id="interactive-section" style="display: none;">
                <div id="boardArea"><div class="year-label">2026 - </div><div id="wordContainer" class="scramble-container"></div><div id="gameInstruction" class="game-instruction">(Cháº¡m vÃ o 2 chá»¯ cÃ¡i Ä‘á»ƒ Ä‘á»•i vá»‹ trÃ­ cho nhau thÃ nh tá»« cÃ³ nghÄ©a)</div></div>
                <div id="finalTextContainer" style="display: none;"><span class="static-highlight" id="finalText"></span></div>
                <div id="btnLucky" class="btn-lucky" onclick="startShaking()">âœ¨ RÃºt Quáº» Lá»™c Äáº§u NÄƒm ğŸ§§</div>
            </div>
        </div>
    </div>

    <div id="shakingModal"><div class="fortune-container"><div class="sticks-bundle"><div class="stick-sample"></div><div class="stick-sample"></div><div class="stick-sample"></div></div></div><div class="shaking-text">Äang xin keo... ğŸ™</div></div>
    <div id="resultModal">
        <div class="bamboo-card">
            <div class="card-header"><div>Lá»™c</div></div>
            <div class="card-body"><div class="fortune-rank" id="fortune-word">Chá»¯ Lá»™c</div><div class="fortune-content" id="fortune-details"></div><div class="poem" id="fortune-poem"></div></div>
            <button class="btn-get-money-card" onclick="showTreeOverlay()">Nháº­n Lá»™c Äáº§u XuÃ¢n ğŸ§§</button>
        </div>
    </div>

    <div id="treeOverlay">
        <h2 class="tree-title">HÃ¡i Lá»™c Äáº§u XuÃ¢n</h2>
        
        <div class="tree-area">
            
            <div class="pot-lip-back"></div>
            <div class="pot-soil"></div>
            
            <div class="tree-svg-container">
                <svg viewBox="0 0 1000 800" preserveAspectRatio="xMidYMax meet">
                    <defs>
                        <linearGradient id="bark" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" stop-color="#2a160d"/>
                            <stop offset="30%" stop-color="#4a2e1b"/>
                            <stop offset="50%" stop-color="#5c3a21"/>
                            <stop offset="70%" stop-color="#4a2e1b"/>
                            <stop offset="100%" stop-color="#1f0f08"/>
                        </linearGradient>
                    </defs>
                    <path d="M 460 800 C 460 700, 470 600, 480 500 C 490 350, 580 250, 780 150 C 860 110, 930 80, 960 50 C 900 90, 830 140, 730 180 C 600 230, 520 300, 500 380 C 470 280, 340 180, 140 80 C 70 50, 20 20, 0 10 C 50 50, 140 90, 240 140 C 340 210, 410 300, 440 420 C 430 550, 440 700, 450 800 Z" fill="url(#bark)"/>
                    <path d="M 480 500 C 490 400, 540 300, 640 200 C 710 140, 770 90, 810 50 C 770 90, 690 150, 630 220 C 570 290, 520 380, 500 460 Z" fill="url(#bark)"/>
                    <path d="M 440 420 C 390 350, 290 280, 170 220 C 110 190, 50 160, 10 130 C 70 170, 140 210, 230 260 C 320 320, 380 380, 410 460 Z" fill="url(#bark)"/>
                    <path d="M 500 380 C 570 340, 670 310, 790 280 C 870 260, 940 240, 970 220 C 910 250, 840 280, 740 310 C 640 340, 540 370, 510 420 Z" fill="url(#bark)"/>
                    <path d="M 485 350 C 470 250, 440 150, 390 50 C 370 20, 340 0, 320 -10 C 350 20, 390 60, 420 120 C 450 200, 470 280, 485 380 Z" fill="url(#bark)"/>
                </svg>
            </div>

            <div class="tree-canopy" id="treeCanopy"></div>

            <div class="pot-lip-front"></div>
            <div class="pot-body"></div>
            
        </div>
    </div>

    <div id="qrOverlay">
        <div class="btn-close-qr" onclick="closeQR()">Ã—</div><div class="qr-title-large" id="qrTitle">LÃ¬ xÃ¬ táº·ng em</div>
        <div class="qr-note-top">(Sá»­ dá»¥ng APP Viettel Money Ä‘á»ƒ quÃ©t QR<br>Nháº¥n giá»¯ vÃ o mÃ£ QR Ä‘á»ƒ lÆ°u áº£nh vá» mÃ¡y)</div>
        <img src="" alt="QR Code" class="qr-img-large" id="qrImgMain">
        <div class="btn-download-bottom" onclick="forceDownloadQR()"><span>â¬‡ï¸</span> Táº£i mÃ£ QR</div><div class="final-message" id="finalMsg"></div>
    </div>

    <div id="qrLightbox" onclick="closeLightbox()"><img src="" id="lightboxImg" class="lightbox-img-content"><div class="lightbox-hint-text">(Cháº¡m Ä‘á»ƒ Ä‘Ã³ng)</div></div>
    <div id="speakerHint" class="speaker-hint">Click Ä‘á»ƒ nghe nháº¡c</div><div id="soundBtn" class="sound-control" onclick="toggleSound(event)">ğŸ”‡</div><audio id="tetMusic" loop><source src="nhac-tet.mp3" type="audio/mpeg"></audio>

    <script>
        var music = document.getElementById('tetMusic'); var soundBtn = document.getElementById('soundBtn'); var speakerHint = document.getElementById('speakerHint'); var isPlaying = false;
        var flowerInterval, treePetalInterval, fireworkIntervalMain;

        const PERSON_DATA = {
            "sep_tung": { skipGame: true, img: "Anh-1.jpg", caption: "Biá»‡t Ä‘á»™i KTCN - KhÃ´ng rÃ o cáº£n, khÃ´ng giá»›i háº¡n ğŸŒŸ", wish: "NhÃ¢n dá»‹p Ä‘áº§u xuÃ¢n nÄƒm má»›i, em kÃ­nh chÃºc Anh vÃ  Gia Ä‘Ã¬nh má»™t nÄƒm dá»“i dÃ o sá»©c khá»e, an khang thá»‹nh vÆ°á»£ng vÃ  váº¡n sá»± nhÆ° Ã½. ChÃºc Anh bÆ°á»›c sang nÄƒm 2026 vá»›i tháº­t nhiá»u thÃ nh cÃ´ng rá»±c rá»¡, tiáº¿p tá»¥c vá»¯ng tay chÃ¨o dáº«n dáº¯t PhÃ²ng KTCN cá»§a chÃºng ta vÆ°á»£t má»i chá»‰ tiÃªu vÃ  gáº·t hÃ¡i nhá»¯ng Ä‘á»‰nh cao má»›i. Em vÃ´ cÃ¹ng trÃ¢n trá»ng vÃ  biáº¿t Æ¡n Anh Ä‘Ã£ luÃ´n láº¯ng nghe, táº¡o Ä‘iá»u kiá»‡n vÃ  Ä‘á»“ng hÃ nh cÃ¹ng chÃºng em trong suá»‘t hÃ nh trÃ¬nh vá»«a qua áº¡! â¤ï¸", highlightText: "VÆ¯á»¢T Káº¾ HOáº CH", qr: "qr-septung.jpg", fortune: { word: "Thá»‘ng LÄ©nh", content: "<p><b>ğŸ‘‘ Sá»± Nghiá»‡p:</b><br>Quyáº¿t Ä‘oÃ¡n, dáº«n dáº¯t Ä‘á»™i ngÅ© vÆ°Æ¡n xa.</p><p><b>ğŸ’° TÃ i Lá»™c:</b><br>Vá»¯ng vÃ ng, gia tÄƒng khÃ´ng ngá»«ng.</p><p><b>ğŸ¡ Gia Äáº¡o:</b><br>An khang, thá»‹nh vÆ°á»£ng, sum váº§y.</p>", poem: "\"Cáº§m quÃ¢n vá»¯ng lÃ¡i thuyá»n ra biá»ƒn<br>Váº¡n sá»± hanh thÃ´ng, phÃºc lá»™c tiá»n\"" } },
            "sep_doanh": { skipGame: false, img: "Anh-2.jpg", caption: "Biá»‡t Äá»™i SÄƒn Bug - QuÃ©t Sáº¡ch Má»i Lá»—i ğŸ›ğŸ”«", wish: "NhÃ¢n dá»‹p Ä‘áº§u xuÃ¢n nÄƒm má»›i, em kÃ­nh chÃºc Anh vÃ  Gia Ä‘Ã¬nh dá»“i dÃ o sá»©c khá»e, háº¡nh phÃºc viÃªn mÃ£n vÃ  bÃ¬nh an. ChÃºc Anh má»™t nÄƒm BÃ­nh Ngá» 2026 bá»©t phÃ¡ thÃ nh cÃ´ng, dáº«n dáº¯t Team mÃ¬nh ngÃ y cÃ ng gáº¯n káº¿t, vá»¯ng máº¡nh vÃ  xuáº¥t sáº¯c hoÃ n thÃ nh má»i má»¥c tiÃªu Ä‘Æ°á»£c giao. Em thá»±c sá»± biáº¿t Æ¡n Anh vÃ¬ Ä‘Ã£ luÃ´n kiÃªn nháº«n láº¯ng nghe, há»— trá»£ vÃ  dÃ¬u dáº¯t em trong suá»‘t nÄƒm qua áº¡! â¤ï¸", highlightText: "VÆ¯á»¢T Káº¾ HOáº CH", qr: "qr-sepdoanh.jpg", fortune: { word: "Äáº¯c Tháº¯ng", content: "<p><b>ğŸ¤ Äá»“ng Äá»™i:</b><br>TrÃªn dÆ°á»›i má»™t lÃ²ng, sá»©c máº¡nh vÃ´ song.</p><p><b>ğŸš€ CÃ´ng Viá»‡c:</b><br>Thuáº­n buá»“m xuÃ´i giÃ³, thÄƒng tiáº¿n cao.</p><p><b>ğŸ’° Tiá»n Báº¡c:</b><br>Rá»§ng rá»‰nh, Ä‘áº§u tÆ° Ä‘Ã¢u tháº¯ng Ä‘Ã³.</p>", poem: "\"PhÃ³ tÆ°á»›ng tÃ i ba, mÆ°u lÆ°á»£c giá»i<br>CÃ´ng thÃ nh danh toáº¡i, lá»™c Ä‘áº§y nhÃ \"" } },
            "sep_thang": { skipGame: true, img: "Anh-1.jpg", caption: "Biá»‡t Ä‘á»™i KTCN - KhÃ´ng rÃ o cáº£n, khÃ´ng giá»›i háº¡n ğŸŒŸ", wish: "NhÃ¢n dá»‹p Ä‘áº§u xuÃ¢n BÃ­nh Ngá» 2026, em kÃ­nh chÃºc Anh cÃ¹ng Gia Ä‘Ã¬nh dá»“i dÃ o sá»©c khá»e, an khang thá»‹nh vÆ°á»£ng vÃ  váº¡n sá»± nhÆ° Ã½. ChÃºc Anh má»™t nÄƒm má»›i cÃ´ng viá»‡c hanh thÃ´ng, luÃ´n lÃ  ngÆ°á»i quáº£n lÃ½ táº­n tÃ¢m, sÃ¡t cÃ¡nh cÃ¹ng Ban lÃ£nh Ä‘áº¡o chÃ¨o lÃ¡i táº­p thá»ƒ PhÃ²ng KTCN hoÃ n thÃ nh xuáº¥t sáº¯c má»i má»¥c tiÃªu. Em ráº¥t trÃ¢n trá»ng vÃ  cáº£m Æ¡n Anh Ä‘Ã£ luÃ´n láº¯ng nghe, chia sáº» vÃ  háº¿t lÃ²ng há»— trá»£ anh em chÃºng em trong cÃ´ng viá»‡c áº¡! â¤ï¸", highlightText: "VÆ¯á»¢T Káº¾ HOáº CH", qr: "qr-septhang.jpg", fortune: { word: "HÆ°ng Thá»‹nh", content: "<p><b>ğŸ’¼ Sá»± Nghiá»‡p:</b><br>ÄÆ°á»ng cÃ´ng danh rá»™ng má»Ÿ, quáº£n lÃ½ vÃ  Ä‘iá»u hÃ nh Ä‘á»™i ngÅ© xuáº¥t sáº¯c.</p><p><b>ğŸ¤ Uy TÃ­n:</b><br>ÄÆ°á»£c cáº¥p trÃªn tÃ­n nhiá»‡m, cáº¥p dÆ°á»›i kÃ­nh trá»ng, táº­p thá»ƒ Ä‘á»“ng lÃ²ng bá»©t phÃ¡.</p><p><b>ğŸ¡ Gia Äáº¡o:</b><br>BÃ¬nh an, sung tÃºc, phÃºc lá»™c tá» gia.</p>", poem: "\"TrÃ­ sÃ¡ng tÃ¢m trong dÃ¬u dáº¯t Ä‘á»™i<br>CÃ´ng thÃ nh danh toáº¡i lá»™c Ä‘áº§y tay\"" } },
            "tun": { skipGame: false, img: "tun.jpg", caption: "Vá»£ YÃªu Cá»§a Anh â¤ï¸", wish: "NhÃ¢n dá»‹p nÄƒm má»›i, anh chÃºc vá»£ yÃªu cá»§a anh luÃ´n xinh Ä‘áº¹p, ráº¡ng rá»¡ vÃ  ngáº­p trÃ n niá»m vui. Cáº£m Æ¡n em vÃ¬ Ä‘Ã£ luÃ´n kiÃªn nháº«n Ä‘á»“ng hÃ nh cÃ¹ng anh suá»‘t hÆ¡n 4 nÄƒm qua, cÃ¹ng anh san sáº» má»i buá»“n vui, thÄƒng tráº§m trong cuá»™c sá»‘ng. Anh xin lá»—i vÃ¬ Ä‘Ã´i lÃºc sá»± vÃ´ tÃ¢m cá»§a anh Ä‘Ã£ lÃ m em pháº£i buá»“n vÃ  suy nghÄ©. Anh mong ráº±ng trÃªn cháº·ng Ä‘Æ°á»ng dÃ i phÃ­a trÆ°á»›c, dÃ¹ giÃ´ng bÃ£o hay bÃ¬nh yÃªn, vá»£ chá»“ng mÃ¬nh váº«n sáº½ luÃ´n náº¯m cháº·t tay nhau, máº¡nh máº½ vÆ°á»£t qua táº¥t cáº£. Anh yÃªu vá»£ ráº¥t nhiá»u! â¤ï¸", highlightText: "NGá»ŒT NGÃ€O", qr: "qr-tun.jpg", fortune: { word: "ViÃªn MÃ£n", content: "<p><b>ğŸ’– TÃ¬nh Cáº£m:</b><br>Gia Ä‘áº¡o áº¥m Ãªm, vá»£ chá»“ng gáº¯n káº¿t, luÃ´n ngá»t ngÃ o nhÆ° lÃºc má»›i yÃªu.</p><p><b>ğŸ’° Tiá»n TÃ i & CÃ´ng Danh:</b><br>CÃ´ng viá»‡c thuáº­n lá»£i, sá»± nghiá»‡p thÄƒng hoa, tÃ i lá»™c dá»“i dÃ o, Ä‘áº¿m tiá»n má»i tay.</p><p><b>ğŸ’ª Sá»©c Khá»e:</b><br>LuÃ´n bÃ¬nh an, khá»e máº¡nh, nÄƒng lÆ°á»£ng trÃ n trá» Ä‘á»ƒ táº­n hÆ°á»Ÿng cuá»™c sá»‘ng.</p>", poem: "\"TrÄƒm nÄƒm chung bÆ°á»›c chung tÃ¬nh<br>Tiá»n tÃ i, sá»©c khá»e, gia Ä‘Ã¬nh áº¥m Ãªm\"" } },
            "e_linh": { skipGame: false, img: "Anh-2.jpg", caption: "Biá»‡t Äá»™i SÄƒn Bug - QuÃ©t Sáº¡ch Má»i Lá»—i ğŸ›ğŸ”«", wish: "NÄƒm má»›i Ä‘áº¿n rá»“i, anh chÃºc Linh luÃ´n ráº¡ng rá»¡, khá»e máº¡nh vÃ  bÃ¬nh an nhÃ©! ChÃºc cho má»i dá»± Ä‘á»‹nh, káº¿ hoáº¡ch trong nÄƒm 2026 cá»§a em Ä‘á»u sáº½ thÃ nh hiá»‡n thá»±c. Mong em ngÃ y cÃ ng thÄƒng hoa trong cÃ´ng viá»‡c vÃ  sá»›m 'master' máº£ng OTC nha ğŸ˜. Äáº·c biá»‡t, chÃºc chuyá»‡n tÃ¬nh cáº£m cá»§a hai em lÃºc nÃ o cÅ©ng máº·n ná»“ng, ngá»t ngÃ o, luÃ´n tháº¥u hiá»ƒu vÃ  Ä‘á»“ng hÃ nh cÃ¹ng nhau vÆ°á»£t qua má»i cá»™t má»‘c trong cuá»™c sá»‘ng nhÃ©! â¤ï¸", highlightText: "VIÃŠN MÃƒN", qr: "qr-linh.jpg", fortune: { word: "Má»¹ MÃ£n", content: "<p><b>ğŸ’ TÃ¬nh YÃªu:</b><br>ThÃªm pháº§n máº·n ná»“ng, gáº¯n káº¿t, anh ngÆ°á»i yÃªu luÃ´n tháº¥u hiá»ƒu vÃ  cÆ°ng chiá»u.</p><p><b>ğŸ’ƒ Nhan Sáº¯c & Sá»©c Khá»e:</b><br>NgÃ y cÃ ng ráº¡ng rá»¡, nhuáº­n sáº¯c, thá»ƒ lá»±c dá»“i dÃ o.</p><p><b>ğŸ’° Tiá»n TÃ i:</b><br>TÃ i lá»™c hanh thÃ´ng, vÃ­ lÃºc nÃ o cÅ©ng cÄƒng phá»“ng.</p>", poem: "\"TÃ¬nh ná»“ng tháº¯m thiáº¿t máº·n mÃ <br>Tiá»n tÃ i rá»§ng rá»‰nh, ngá»c ngÃ  sáº¯c xuÃ¢n\"" } },
            "e_kimanh": { skipGame: false, img: "Anh-2.jpg", caption: "Biá»‡t Äá»™i SÄƒn Bug - QuÃ©t Sáº¡ch Má»i Lá»—i ğŸ›ğŸ”«", wish: "ChÃ o xuÃ¢n BÃ­nh Ngá», anh chÃºc Kim Anh má»™t nÄƒm ngáº­p trÃ n sá»©c khá»e, niá»m vui vÃ  tháº­t nhiá»u may máº¯n! Mong em trong cÃ´ng viá»‡c sáº½ cÃ ng thÃªm bá»©t phÃ¡, sáº¯c bÃ©n vÃ  tá»‰ má»‰ hÆ¡n ná»¯a â€“ hÃ£y luÃ´n phÃ¡t huy nhá»¯ng tháº¿ máº¡nh vÃ  khÃ´ng ngá»«ng hoÃ n thiá»‡n báº£n thÃ¢n má»—i ngÃ y nhÃ©. VÃ  Ä‘iá»u quan trá»ng nháº¥t: chÃºc em sá»›m chÃ­nh thá»©c 'chá»‘t Ä‘Æ¡n' Ä‘Æ°á»£c má»™t anh ngÆ°á»i yÃªu cá»±c pháº©m, áº¥m Ã¡p vÃ  luÃ´n cÆ°ng chiá»u em háº¿t má»±c nha! ğŸ˜", highlightText: "Rá»°C Rá» ", qr: "qr-kimanh.jpg", fortune: { word: "Hanh ThÃ´ng", content: "<p><b>ğŸ’– TÃ¬nh DuyÃªn:</b><br>Buá»•i háº¹n hÃ² lÃ£ng máº¡n ná»Ÿ hoa, sá»›m ngÃ y chÃ­nh thá»©c chung Ä‘Ã´i.</p><p><b>ğŸ’» CÃ´ng Viá»‡c:</b><br>SuÃ´n sáº» thuáº­n lá»£i, 'bÃ n tay vÃ ng' test Ä‘Ã¢u chuáº©n Ä‘áº¥y, zero bug!</p><p><b>ğŸ€ May Máº¯n & Tiá»n TÃ i:</b><br>Sá»©c khá»e dáº»o dai, phÃº quÃ½ ngáº­p trÃ n, lÃ m Ä‘Ã¢u tháº¯ng Ä‘Ã³.</p>", poem: "\"TÃ¬nh duyÃªn chá»›m ná»Ÿ ngá»t ngÃ o<br>CÃ´ng viá»‡c mÆ°á»£t mÃ , lá»™c vÃ o nhÆ° mÆ°a\"" } },
            "e_vinh": { skipGame: false, img: "Anh-2.jpg", caption: "Biá»‡t Äá»™i SÄƒn Bug - QuÃ©t Sáº¡ch Má»i Lá»—i ğŸ›ğŸ”«", wish: "NhÃ¢n dá»‹p nÄƒm má»›i, anh chÃºc Vinh vÃ  gia Ä‘Ã¬nh luÃ´n dá»“i dÃ o sá»©c khá»e, an yÃªn vÃ  háº¡nh phÃºc. Nhá»¯ng ná»—i buá»“n cá»§a nÄƒm cÅ© hÃ£y nháº¹ nhÃ ng gÃ¡c láº¡i em nhÃ©, Ä‘á»ƒ má»Ÿ lÃ²ng Ä‘Ã³n nháº­n muÃ´n vÃ n niá»m vui vÃ  hy vá»ng rá»±c rá»¡ trong nÄƒm BÃ­nh Ngá». ChÃºc em má»™t nÄƒm 2026 tháº­t máº¡nh máº½, tá»± bá»©t phÃ¡ Ä‘á»ƒ gáº·t hÃ¡i nhiá»u thÃ nh tá»±u lá»›n trong cÃ´ng viá»‡c. Äáº·c biá»‡t, chÃºc cho háº¡t giá»‘ng tÃ¬nh cáº£m em Ä‘ang Æ°Æ¡m máº§m sáº½ sá»›m Ä‘Æ¡m hoa káº¿t trÃ¡i ngá»t ngÃ o nha! ğŸ˜œ", highlightText: "Máº NH Máº¼", qr: "qr-vinh.jpg", fortune: { word: "An YÃªn", content: "<p><b>ğŸŒ» Tinh Tháº§n & Gia ÄÃ¬nh:</b><br>GÃ¡c láº¡i muá»™n phiá»n, cÃµi lÃ²ng bÃ¬nh an, Ä‘Ã³n nháº­n vÃ´ vÃ n niá»m vui má»›i.</p><p><b>ğŸ’˜ TÃ¬nh DuyÃªn:</b><br>Khoáº£ng cÃ¡ch gáº§n ngay chá»‘n cÃ´ng sá»Ÿ, duyÃªn lÃ nh Ä‘Æ°a tá»›i, sá»›m chung lá»‘i vá».</p><p><b>ğŸ’¼ CÃ´ng Viá»‡c & TÃ i Lá»™c:</b><br>Thuáº­n buá»“m xuÃ´i giÃ³, thÄƒng tiáº¿n khÃ´ng ngá»«ng, tiá»n báº¡c rá»§ng rá»‰nh.</p>", poem: "\"Qua cÆ¡n mÆ°a, trá»i láº¡i sÃ¡ng trong<br>TÃ¬nh duyÃªn gÃµ cá»­a, cÃµi lÃ²ng an vui\"" } },
            "e_duc": { skipGame: false, img: "Anh-2.jpg", caption: "Biá»‡t Äá»™i SÄƒn Bug - QuÃ©t Sáº¡ch Má»i Lá»—i ğŸ›ğŸ”«", wish: "ChÃºc má»«ng nÄƒm má»›i Äá»©c! Anh chÃºc em má»™t nÄƒm tháº­t nhiá»u sá»©c khá»e, luÃ´n vui váº» vÃ  váº¡n sá»± hanh thÃ´ng. NÄƒm 2026 nÃ y, chÃºc em ngÃ y cÃ ng chá»¯ng cháº¡c, tá»± tin vÃ  tá»a sÃ¡ng hÆ¡n ná»¯a trÃªn cÆ°Æ¡ng vá»‹ chÃ­nh thá»©c má»›i. HÃ£y luÃ´n biáº¿t cÃ¡ch phÃ¡t huy tháº¿ máº¡nh, rÃ¨n giÅ©a báº£n thÃ¢n Ä‘á»ƒ khÃ´ng ngá»«ng thÄƒng tiáº¿n nhÃ©. VÃ  táº¥t nhiÃªn, chÃºc cho tÃ¬nh yÃªu cá»§a em lÃºc nÃ o cÅ©ng Ä‘ong Ä‘áº§y háº¡nh phÃºc vÃ  ngá»t ngÃ o! ğŸ‰", highlightText: "Vá»®NG BÆ¯á»šC", qr: "qr-duc.jpg", fortune: { word: "Khá»Ÿi Sáº¯c", content: "<p><b>ğŸš€ CÃ´ng Viá»‡c:</b><br>Khá»Ÿi Ä‘áº§u má»›i rá»±c rá»¡ vá»›i báº£n há»£p Ä‘á»“ng chÃ­nh thá»©c! NgÃ y cÃ ng trÆ°á»Ÿng thÃ nh, tá»± tin vÆ°Æ¡n xa.</p><p><b>ğŸ’• TÃ¬nh YÃªu:</b><br>Ngá»t ngÃ o Ä‘áº¯m say, háº¡nh phÃºc Ä‘ong Ä‘áº§y bÃªn ná»­a kia yÃªu thÆ°Æ¡ng.</p><p><b>ğŸ€ Sá»©c Khá»e & May Máº¯n:</b><br>Thá»ƒ cháº¥t khang kiá»‡n, Ä‘i tá»›i Ä‘Ã¢u váº¡n sá»± cÃ¡t tÆ°á»ng tá»›i Ä‘Ã³.</p>", poem: "\"ChÃ­nh thá»©c cáº¥t cÃ¡nh bay xa<br>Tá»± tin vá»¯ng bÆ°á»›c, tÃ¬nh ca ngá»t ngÃ o\"" } },
            "e_trung": { skipGame: false, img: "Anh-2.jpg", caption: "Biá»‡t Äá»™i SÄƒn Bug - QuÃ©t Sáº¡ch Má»i Lá»—i ğŸ›ğŸ”«", wish: "NÄƒm má»›i BÃ­nh Ngá», anh chÃºc Trung luÃ´n dá»“i dÃ o sá»©c khá»e, bÃ¬nh an, váº¡n sá»± nhÆ° Ã½, vÃ  Ä‘áº·c biá»‡t lÃ  lÃªn sá»›i 'bÃ i' nÃ o tháº¯ng Ä‘áº­m sá»›i Ä‘Ã³ nha ğŸ˜…. ChÃºc em má»™t nÄƒm 2026 bá»©t phÃ¡ rá»±c rá»¡, má»i cÃ´ng viá»‡c, dá»± Ä‘á»‹nh cÃ¡ nhÃ¢n láº«n cÃ¡c bÃ i toÃ¡n automation Ä‘á»u 'auto' cháº¡y mÆ°á»£t mÃ , pass xanh lÃ¨ má»i cases vÃ  hoÃ n thÃ nh xuáº¥t sáº¯c má»i má»¥c tiÃªu nhÃ©! ğŸš€", highlightText: "MÆ¯á»¢T MÃ€", qr: "qr-trung.jpg", fortune: { word: "ThÃ nh Äáº¡t", content: "<p><b>ğŸ“ˆ CÃ´ng Danh:</b><br>ViÃªn mÃ£n váº¹n toÃ n, sá»± nghiá»‡p thÄƒng hoa bá»©t phÃ¡ trong nÄƒm má»›i.</p><p><b>âš™ï¸ Automation:</b><br>Code cháº¡y 'auto' mÆ°á»£t mÃ , pass má»i case hÃ³c bÃºa, khÃ´ng lo gÃ£y script.</p><p><b>ğŸ’ª Sá»©c Khá»e & TÃ¬nh DuyÃªn:</b><br>Thá»ƒ lá»±c sung mÃ£n, tÃ¬nh duyÃªn phÆ¡i phá»›i, ráº¡ng rá»¡ ná»¥ cÆ°á»i.</p>", poem: "\"CÃ´ng danh sá»± nghiá»‡p vÆ°Æ¡n xa<br>Auto cháº¡y mÆ°á»£t, tÃ¬nh Ä‘Ã  ná»Ÿ hoa\"" } },
            "e_huy": { skipGame: false, img: "Anh-2.jpg", caption: "Biá»‡t Äá»™i SÄƒn Bug - QuÃ©t Sáº¡ch Má»i Lá»—i ğŸ›ğŸ”«", wish: "NhÃ¢n dá»‹p xuÃ¢n má»›i, anh chÃºc Huy cÃ¹ng tá»• áº¥m nhá» cá»§a mÃ¬nh má»™t nÄƒm bÃ¬nh an, máº¡nh khá»e vÃ  ngáº­p trÃ n háº¡nh phÃºc. ChÃºc em sáº½ ngÃ y cÃ ng báº£n lÄ©nh, chá»¯ng cháº¡c Ä‘á»ƒ sáºµn sÃ ng tá»a sÃ¡ng trong nhá»¯ng cÆ°Æ¡ng vá»‹ vÃ  vai trÃ² má»›i sáº¯p tá»›i ğŸ˜Š. DÃ¹ ráº½ hÆ°á»›ng theo báº¥t ká»³ con Ä‘Æ°á»ng nÃ o, anh tin vá»›i sá»± tá»± tin vÃ  ná»— lá»±c bá»n bá»‰, em cháº¯c cháº¯n sáº½ gáº·t hÃ¡i Ä‘Æ°á»£c nhá»¯ng thÃ nh cÃ´ng rá»±c rá»¡ nháº¥t! ğŸ’ª", highlightText: "Báº¢N LÄ¨NH", qr: "qr-huy.jpg", fortune: { word: "Vá»¯ng BÆ°á»›c", content: "<p><b>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Gia ÄÃ¬nh:</b><br>Háº¡nh phÃºc viÃªn mÃ£n, Ä‘Ã³n nháº­n tin vui.</p><p><b>ğŸ’¼ Sá»± Nghiá»‡p:</b><br>Vá»¯ng vÃ ng, Ä‘á»‹nh hÆ°á»›ng rÃµ rÃ ng, thÃ nh cÃ´ng phÃ­a trÆ°á»›c.</p><p><b>ğŸ’ª Báº£n LÄ©nh:</b><br>TrÆ°á»Ÿng thÃ nh, vá»¯ng vÃ ng trÆ°á»›c má»i thá»­ thÃ¡ch.</p>", poem: "\"TrÃ¡ch nhiá»‡m trÃªn vai chÃ­ thÃªm bá»n<br>ThÃ nh cÃ´ng gÃµ cá»­a ráº¡ng tÆ°Æ¡ng lai\"" } }
        };

        let charIndex = 0; let isTypingPart2 = false; let selectedPerson = ""; let treeInitialized = false;
        const typeSpeed = 30;
        const ignoreChars = [' ', '-']; 
        
        window.onload = function() {
            let idParam = new URLSearchParams(window.location.search).get('id');
            selectedPerson = (idParam && PERSON_DATA[idParam.trim().toLowerCase()]) ? idParam.trim().toLowerCase() : 'e_linh';
            
            flowerInterval = setInterval(createFlower, 450); 
            music.play().then(() => { isPlaying = true; updateSoundIcon(true); }).catch(() => { updateSoundIcon(false); });
        };

        function updateSoundIcon(playing) { soundBtn.innerHTML = playing ? 'ğŸ”Š' : 'ğŸ”‡'; soundBtn.style.animation = playing ? 'none' : 'pulse-btn 2s infinite'; }
        function toggleSound(event) { event.stopPropagation(); speakerHint.style.display = 'none'; if (music.paused) { music.play(); isPlaying = true; updateSoundIcon(true); } else { music.pause(); isPlaying = false; updateSoundIcon(false); } }
        function playAudioForce() { if (music.paused) { music.play().then(() => { isPlaying = true; updateSoundIcon(true); }).catch((e) => console.log(e)); } }
        
        function openEnvelope() { 
            playAudioForce(); 
            speakerHint.style.display = 'none'; 
            document.getElementById('coupletLeft').style.display = 'none'; 
            document.getElementById('coupletRight').style.display = 'none'; 
            document.getElementById('envelope').style.display = 'none'; 
            document.getElementById('content').style.display = 'block'; 
            
            fireworkIntervalMain = setInterval(createFirework, 1800); 
            createFirework(); setTimeout(createFirework, 600); setTimeout(createFirework, 1200);
            
            showImageAndStartGreeting(); 
        }

        function showImageAndStartGreeting() {
            const data = PERSON_DATA[selectedPerson];
            const imgContainer = document.getElementById("extra-image-container"); 
            const greetingImg = document.getElementById("mainImage"); 
            const caption = document.getElementById("imageCaption");
            
            greetingImg.src = data.img; 
            caption.innerText = data.caption;
            imgContainer.style.display = "block"; setTimeout(typeWriter, 500);
        }

        function typeWriter() {
            const container = document.getElementById("type-text"); const pen = document.getElementById("writing-pen");
            const data = PERSON_DATA[selectedPerson]; const textPart1 = data.wish;
            if (!isTypingPart2) {
                if (charIndex < textPart1.length) { container.innerHTML += textPart1.charAt(charIndex); charIndex++; setTimeout(typeWriter, typeSpeed); if(charIndex % 20 === 0) { const contentDiv = document.getElementById('content'); contentDiv.scrollTo({ top: contentDiv.scrollHeight, behavior: 'smooth' }); } } 
                else { isTypingPart2 = true; pen.style.display = "none"; initGameOrShowBoss(); }
            }
        }

        /* --- GAME LOGIC --- */
        let currentSelected = null; let wordOrder = []; let correctOrder = [];
        function initGameOrShowBoss() {
            const data = PERSON_DATA[selectedPerson];
            const interactiveSection = document.getElementById("interactive-section"); const boardArea = document.getElementById("boardArea");
            const finalTextContainer = document.getElementById("finalTextContainer"); const finalText = document.getElementById("finalText");
            const btnLucky = document.getElementById("btnLucky"); const contentDiv = document.getElementById('content');
            
            interactiveSection.style.display = "block";
            
            if (data.skipGame) {
                boardArea.style.display = "none"; 
                const fullText = "2026 - " + data.highlightText;
                
                // ÄÃ£ chÃ¨n delay 2 giÃ¢y trÆ°á»›c khi show káº¿t quáº£ 
                setTimeout(() => {
                    const backdrop = document.createElement("div"); backdrop.className = "celebration-backdrop"; document.body.appendChild(backdrop);
                    const popup = document.createElement("div"); popup.className = "celebration-popup"; popup.innerText = fullText; document.body.appendChild(popup);
                    createFirework(); setTimeout(createFirework, 800); setTimeout(createFirework, 1600);
                    
                    setTimeout(() => {
                        popup.remove(); backdrop.remove(); 
                        finalText.innerText = fullText; finalTextContainer.style.display = "block"; btnLucky.style.display = "block"; 
                        contentDiv.scrollTo({ top: contentDiv.scrollHeight, behavior: 'smooth' }); 
                    }, 3000);
                }, 1300);
            } else {
                boardArea.style.display = "block"; correctOrder = data.highlightText.split('');
                
                if (correctOrder.length > 15) { document.getElementById("wordContainer").classList.add("long-text"); }

                let letters = correctOrder.filter(c => !ignoreChars.includes(c)); 
                let originalLetters = letters.join('');
                shuffleArray(letters); while(letters.join('') === originalLetters && letters.length > 1) { shuffleArray(letters); }
                wordOrder = correctOrder.map(c => ignoreChars.includes(c) ? c : letters.pop()); 
                renderGame(); setTimeout(() => { contentDiv.scrollTo({ top: contentDiv.scrollHeight, behavior: 'smooth' }); }, 200);
            }
        }
        
        function shuffleArray(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } }
        
        function renderGame() {
            const container = document.getElementById("wordContainer"); container.innerHTML = ''; 
            wordOrder.forEach((char, index) => {
                if (ignoreChars.includes(char)) { 
                    const space = document.createElement("div"); 
                    space.className = char === '-' ? "dash-chip" : "space-chip"; 
                    if (char === '-') space.innerText = '-';
                    container.appendChild(space); 
                } else {
                    const chip = document.createElement("div"); chip.className = "letter-chip"; if (index === currentSelected) chip.classList.add("selected");
                    chip.innerText = char; chip.onclick = () => handleWordClick(index); container.appendChild(chip);
                }
            });
        }

        function handleWordClick(index) {
            if (document.getElementById("btnLucky").style.display === "block") return; if (ignoreChars.includes(wordOrder[index])) return;
            if (currentSelected === null) { currentSelected = index; renderGame(); } else {
                if (currentSelected !== index) { let temp = wordOrder[currentSelected]; wordOrder[currentSelected] = wordOrder[index]; wordOrder[index] = temp; currentSelected = null; renderGame(); checkWin(); } 
                else { currentSelected = null; renderGame(); }
            }
        }

        function checkWin() {
            if (wordOrder.join('') === correctOrder.join('')) {
                document.querySelectorAll(".letter-chip").forEach(chip => chip.classList.add("correct"));
                const instr = document.getElementById("gameInstruction"); instr.innerText = "Tuyá»‡t vá»i! ChÃºc má»«ng!"; instr.style.color = "#28a745";
                setTimeout(() => {
                    document.getElementById("boardArea").style.display = "none"; const backdrop = document.createElement("div"); backdrop.className = "celebration-backdrop"; document.body.appendChild(backdrop);
                    const fullText = "2026 - " + correctOrder.join(''); const popup = document.createElement("div"); popup.className = "celebration-popup"; popup.innerText = fullText; document.body.appendChild(popup);
                    
                    createFirework(); setTimeout(createFirework, 800); setTimeout(createFirework, 1600); setTimeout(createFirework, 2400);
                    
                    setTimeout(() => {
                        popup.remove(); backdrop.remove(); document.getElementById("finalText").innerText = fullText; document.getElementById("finalTextContainer").style.display = "block";
                        document.getElementById("btnLucky").style.display = "block"; const contentDiv = document.getElementById('content'); contentDiv.scrollTo({ top: contentDiv.scrollHeight, behavior: 'smooth' }); 
                    }, 3000); 
                }, 800);
            }
        }

        function startShaking() {
            document.getElementById('shakingModal').style.display = 'flex';
            const data = PERSON_DATA[selectedPerson].fortune;
            document.getElementById('fortune-word').innerHTML = data.word || "BÃ¬nh An";
            document.getElementById('fortune-details').innerHTML = data.content || "<p><b>ğŸ€ May Máº¯n:</b><br>Má»i sá»± hanh thÃ´ng.</p>";
            document.getElementById('fortune-poem').innerHTML = data.poem || "\"PhÃºc lá»™c dá»“i dÃ o váº¡n sá»± an\"";
            setTimeout(function() { document.getElementById('shakingModal').style.display = 'none'; document.getElementById('resultModal').style.display = 'flex'; }, 3000);
        }

        /* --- CÃ‚Y ÄÃ€O 3D & LÃŒ XÃŒ --- */
        function showTreeOverlay() {
            document.getElementById('resultModal').style.display = 'none'; document.getElementById('content').style.display = 'none';
            document.getElementById('treeOverlay').style.display = 'flex';
            
            clearInterval(flowerInterval); 
            clearInterval(fireworkIntervalMain); 
            
            treePetalInterval = setInterval(createTreeFallingPetal, 300);

            if (!treeInitialized) { generateTree(); treeInitialized = true; }
        }

        function generateTree() {
            const canopy = document.getElementById('treeCanopy'); canopy.innerHTML = '';
            
            const zones = [
                {x: 10, y: 10, w: 35, h: 40},   
                {x: 55, y: 5, w: 40, h: 35},    
                {x: 55, y: 35, w: 35, h: 25},   
                {x: 35, y: 0, w: 25, h: 40},    
                {x: 40, y: 40, w: 20, h: 30}    
            ];

            for (let i = 0; i < 180; i++) {
                let zone = zones[Math.floor(Math.random() * zones.length)];
                let cx = zone.x + Math.random() * zone.w;
                let cy = zone.y + Math.random() * zone.h;

                const isFlower = Math.random() > 0.30; 
                let element = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                let useTag = document.createElementNS("http://www.w3.org/2000/svg", "use");
                
                element.style.position = "absolute"; element.style.left = cx + '%'; element.style.top = cy + '%'; element.style.overflow = "visible";
                
                if (isFlower) {
                    element.setAttribute("class", "svg-flower"); useTag.setAttribute("href", "#peach-flower");
                    element.style.width = (15 + Math.random()*15) + 'px'; element.style.height = element.style.width; element.style.animationDelay = (Math.random() * 3) + 's';
                } else {
                    element.setAttribute("class", "svg-leaf"); useTag.setAttribute("href", "#peach-leaf");
                    element.style.width = (12 + Math.random()*8) + 'px'; element.style.height = element.style.width; element.style.transform = `rotate(${Math.random()*360}deg)`;
                }
                element.appendChild(useTag); canopy.appendChild(element);
            }

            const qrImage = PERSON_DATA[selectedPerson].qr;
            const envPos = [
                [20, 25], [30, 15], [40, 40], [25, 45], 
                [65, 12], [80, 20], [90, 35], [75, 48], [60, 52], 
                [48, 5], [55, 25], [45, 25], 
                [35, 30], [50, 60], [85, 55], [15, 35] 
            ];
            
            for (let i = 0; i < envPos.length; i++) {
                let wrap = document.createElement('div'); wrap.className = 'tree-envelope-wrapper';
                const pos = envPos[i];
                wrap.style.left = pos[0] + '%'; wrap.style.top = pos[1] + '%'; wrap.style.animationDelay = (Math.random() * 2) + 's';
                wrap.innerHTML = `<div class="env-string"></div><div class="tree-envelope"><div class="epass-logo">ePass</div><div class="qr-pop-out"><img src="${qrImage}" style="width:100%;height:100%; object-fit: cover;"></div></div>`;
                
                let envBox = wrap.querySelector('.tree-envelope');
                envBox.onclick = function(e) { e.stopPropagation(); pickEnvelope(this, qrImage); };
                canopy.appendChild(wrap);
            }
        }

        function pickEnvelope(envBox, qrImage) {
            let wrapElement = envBox.parentElement;
            if (wrapElement.classList.contains('opened')) return; wrapElement.classList.add('opened'); 
            const rect = envBox.getBoundingClientRect();
            const cloneWrap = document.createElement('div'); cloneWrap.className = 'env-clone-wrap';
            cloneWrap.style.position = 'fixed'; cloneWrap.style.top = rect.top + 'px'; cloneWrap.style.left = rect.left + 'px';
            cloneWrap.innerHTML = `<div class="env-clone"><div class="epass-logo">ePass</div><div class="qr-pop-out"><img src="${qrImage}" style="width:100%;height:100%; object-fit: cover; border-radius: 2px;"></div></div>`;
            document.body.appendChild(cloneWrap); wrapElement.style.opacity = '0';
            void cloneWrap.offsetWidth; cloneWrap.classList.add('fly-and-open');
            setTimeout(() => { document.getElementById('treeOverlay').style.display = 'none'; showQRModalReal(qrImage); cloneWrap.remove(); clearInterval(treePetalInterval); }, 2100); 
        }

        /* --- Xá»¬ LÃ QR & HIá»†U á»¨NG CHUNG --- */
        function showQRModalReal(qrImageSrc) {
            const data = PERSON_DATA[selectedPerson];
            const qrTitle = document.getElementById('qrTitle'); const qrImgMain = document.getElementById('qrImgMain'); const finalMsg = document.getElementById('finalMsg');
            qrImgMain.src = qrImageSrc;
            
            if (selectedPerson === 'tun') {
                qrTitle.innerText = "LÃ¬ XÃ¬ Cho Vá»£ YÃªu"; finalMsg.innerText = "ChÃºc vá»£ yÃªu cá»§a anh nÄƒm má»›i ngáº­p trÃ n niá»m vui, lÃºc nÃ o cÅ©ng cÆ°á»i tÆ°Æ¡i ráº¡ng rá»¡ vÃ  mÃ£i lÃ  háº­u phÆ°Æ¡ng vá»¯ng cháº¯c nháº¥t cá»§a gia Ä‘Ã¬nh mÃ¬nh nhÃ©! â¤ï¸";
            } else if (selectedPerson === 'sep_tung' || selectedPerson === 'sep_doanh' || selectedPerson === 'sep_thang') { 
                // Kiá»ƒm tra trá»±c tiáº¿p ID cá»§a 3 sáº¿p á»Ÿ Ä‘Ã¢y
                qrTitle.innerText = "Khai XuÃ¢n Äáº¯c Lá»™c"; finalMsg.innerText = "Tuy giÃ¡ trá»‹ lÃ¬ xÃ¬ khÃ´ng lá»›n, nhÆ°ng Ä‘Ã¢y lÃ  táº¥m lÃ²ng cá»§a em gá»­i tá»›i Anh nhÃ¢n dá»‹p Ä‘áº§u xuÃ¢n nÄƒm má»›i. KÃ­nh chÃºc Anh má»™t nÄƒm BÃ­nh Ngá» 2026 tháº­t nhiá»u sá»©c khá»e, háº¡nh phÃºc vÃ  thÃ nh cÃ´ng rá»±c rá»¡! ğŸ˜Š"; 
            } else { 
                qrTitle.innerText = "May máº¯n Ä‘áº§u xuÃ¢n"; finalMsg.innerText = "Tuy giÃ¡ trá»‹ lÃ¬ xÃ¬ khÃ´ng lá»›n, nhÆ°ng hy vá»ng nÃ³ sáº½ mang láº¡i cho em chÃºt niá»m vui vÃ  may máº¯n trong ngÃ y Ä‘áº§u nÄƒm ğŸ˜‰"; 
            }
            document.getElementById('qrOverlay').style.display = 'flex';

            // Khá»Ÿi Ä‘á»™ng láº¡i cÃ¡c hiá»‡u á»©ng rÆ¡i vÃ  phÃ¡o hoa cho mÃ n QR
            clearInterval(flowerInterval);
            flowerInterval = setInterval(createFlower, 450);
            clearInterval(fireworkIntervalMain);
            fireworkIntervalMain = setInterval(createFirework, 1800);
            createFirework();
        }

        function forceDownloadQR() {
            const imgSrc = document.getElementById('qrImgMain').src;
            fetch(imgSrc).then(resp => resp.blob()).then(blob => {
                const url = window.URL.createObjectURL(blob); const a = document.createElement('a'); a.style.display = 'none'; a.href = url; a.download = 'LiXi_Tet_2026.jpg'; document.body.appendChild(a); a.click(); window.URL.revokeObjectURL(url);
            }).catch(() => { const a = document.createElement('a'); a.href = imgSrc; a.download = 'LiXi_Tet_2026.jpg'; a.click(); });
        }
        function closeQR() { document.getElementById('qrOverlay').style.display = 'none'; document.getElementById('content').style.display = 'block'; fireworkIntervalMain = setInterval(createFirework, 1800); }
        function openLightbox(imgSrc) { document.getElementById("lightboxImg").src = imgSrc; document.getElementById("qrLightbox").style.display = "flex"; }
        function closeLightbox() { document.getElementById("qrLightbox").style.display = "none"; }
        
        function createFlower() {
            const flower = document.createElement('div'); flower.className = 'flower'; flower.innerHTML = Math.random() > 0.5 ? 'ğŸŒ¸' : 'ğŸŒ¼'; 
            flower.style.left = Math.random() * 100 + 'vw'; flower.style.fontSize = (Math.random() * 20 + 10) + 'px';
            const duration = Math.random() * 5 + 5; 
            flower.style.setProperty('--fall-rot', Math.random() * 360 + 'deg'); flower.style.animation = `fall ${duration}s linear forwards`;
            document.body.appendChild(flower); setTimeout(() => { flower.remove(); }, duration * 1000);
        }

        function createTreeFallingPetal() {
            let element = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            let useTag = document.createElementNS("http://www.w3.org/2000/svg", "use");
            element.setAttribute("class", "tree-falling-petal");
            useTag.setAttribute("href", "#peach-flower");
            element.style.width = (12 + Math.random()*8) + 'px'; element.style.height = element.style.width;
            element.style.left = (Math.random() * 100) + 'vw';
            
            const duration = Math.random() * 4 + 4;
            element.style.setProperty('--fall-rot', Math.random() * 360 + 'deg');
            element.style.setProperty('--fall-drift', (Math.random() * 200 - 100) + 'px');
            element.style.animation = `tree-fall ${duration}s linear forwards`;
            
            element.appendChild(useTag);
            document.getElementById('treeOverlay').appendChild(element);
            setTimeout(() => { element.remove(); }, duration * 1000);
        }

        function createFirework() {
            const shell = document.createElement('div'); shell.className = 'firework-shell'; shell.style.left = Math.random() * 90 + 5 + 'vw'; shell.style.top = Math.random() * 60 + 10 + 'vh'; document.body.appendChild(shell);
            const colors = ['#ff0000', '#ffff00', '#00ff00', '#00ffff', '#ff00ff', '#ffaa00', '#ffffff']; const color = colors[Math.floor(Math.random() * colors.length)];
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div'); particle.className = 'firework-particle'; particle.style.backgroundColor = color;
                const size = Math.random() * 3 + 2 + 'px'; particle.style.width = size; particle.style.height = size;
                particle.style.boxShadow = `0 0 10px ${color}, 0 0 20px ${color}`;
                const angle = (i / 50) * 360 * (Math.PI / 180); const distance = Math.random() * 200 + 50;
                const x = Math.cos(angle) * distance + 'px'; const y = Math.sin(angle) * distance + 'px';
                particle.style.setProperty('--x', x); particle.style.setProperty('--y', y); shell.appendChild(particle);
            }
            setTimeout(() => { shell.remove(); }, 1200);
        }
    </script>
</body>
</html>
