<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gieo Qu·∫ª ƒê·∫ßu NƒÉm 2026</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üßß</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    
    <style>
        /* --- 1. C·∫§U H√åNH CHUNG --- */
        body {
            margin: 0; padding: 0; display: flex; justify-content: center; align-items: center;
            height: 100dvh; 
            background: linear-gradient(135deg, #8a0000 0%, #ff1a1a 100%);
            font-family: 'Segoe UI', Roboto, Arial, sans-serif;
            overflow: hidden; text-align: center; color: white;
        }

        /* --- 2. NG·ª∞A PHI --- */
        .horse-container {
            position: absolute; bottom: 15px; left: -300px;
            z-index: 5; pointer-events: none;
            display: flex; gap: -20px;
            animation: runAcross 7s linear infinite;
        }
        .horse-unit {
            font-size: 80px; display: inline-block;
            transform: scaleX(-1);
            filter: drop-shadow(5px 5px 5px rgba(0,0,0,0.5));
        }
        .galloping { animation: gallop 0.6s ease-in-out infinite alternate; }
        .horse-red { filter: hue-rotate(-50deg) saturate(2) drop-shadow(5px 5px 5px rgba(0,0,0,0.5)); }
        .horse-gold { filter: hue-rotate(45deg) saturate(3) brightness(1.2) drop-shadow(5px 5px 5px rgba(0,0,0,0.5)); animation-delay: 0.1s; }
        .horse-brown { animation-delay: 0.2s; }
        @keyframes runAcross { 0% { left: -300px; } 100% { left: 110vw; } }
        @keyframes gallop { 0% { transform: scaleX(-1) translateY(0) rotate(0deg); } 100% { transform: scaleX(-1) translateY(-20px) rotate(5deg); } }

        /* --- 3. N√öT LOA & G·ª¢I √ù --- */
        .sound-control {
            position: fixed; top: 20px; right: 20px;
            width: 25px; height: 25px; 
            background: rgba(0, 0, 0, 0.6); border: 2px solid #ffd700; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 18px; cursor: pointer; z-index: 200; 
            transition: transform 0.2s; animation: pulse-btn 2s infinite;
        }
        
        .speaker-hint {
            position: fixed; top: 20px; right: 50px; 
            z-index: 200; 
            color: #fff; font-size: 12px; font-weight: bold;
            background: #d00000; 
            padding: 2px 5px; border-radius: 40px;
            border: 1px solid #ffd700; 
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            pointer-events: none; 
            display: flex; align-items: center; gap: 5px;
            animation: hint-bounce 1s infinite alternate;
            white-space: nowrap; 
        }
        .speaker-hint::after { content: '‚û°Ô∏è'; font-size: 18px; }

        @keyframes hint-bounce { 0% { transform: translateX(0); } 100% { transform: translateX(-5px); } }
        @keyframes pulse-btn { 0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(255, 215, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); } }

        /* --- 4. BAO L√å X√å --- */
        #envelope {
            width: 300px; height: 450px;
            background: linear-gradient(to bottom, #b30000, #e60000);
            border: 4px solid #ffd700; border-radius: 20px;
            cursor: pointer; display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            box-shadow: 0 10px 50px rgba(0,0,0,0.7);
            transition: transform 0.3s; z-index: 20; position: relative;
            margin-bottom: 80px; 
        }
        #envelope:hover { transform: scale(1.05); }
        .envelope-icon { font-size: 80px; margin-bottom: -10px; filter: drop-shadow(0 4px 4px rgba(0,0,0,0.3)); }
        .year-text { font-size: 35px; font-weight: 900; color: #ffd700; text-shadow: 3px 3px 0px #8b0000; font-family: 'Arial Black', sans-serif; margin-bottom: 10px; }
        .click-hint { font-size: 18px; font-weight: bold; margin-top: 20px; animation: blink 1.5s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }

        /* --- C√ÇU ƒê·ªêI N·∫∞M GI·ªÆA HAI B√äN (ƒê√É S·ª¨A C·ª† CH·ªÆ) --- */
        .couplet {
            position: fixed; 
            top: 50%; 
            width: 48px; /* Ch·ªânh l·∫°i khung cho g·ªçn */
            background: linear-gradient(to bottom, #b30000, #990000);
            border: 3px solid #ffd700; 
            border-radius: 4px;
            color: #ffd700; font-family: 'Times New Roman', serif;
            font-weight: 900; text-align: center;
            padding: 15px 0; 
            box-shadow: 4px 4px 15px rgba(0,0,0,0.5), inset 0 0 10px rgba(0,0,0,0.3);
            z-index: 5; 
            display: flex; flex-direction: column; align-items: center; gap: 6px; /* Kho·∫£ng c√°ch gi·ªØa c√°c ch·ªØ */
            animation: floatCouplet 3s ease-in-out infinite alternate;
        }
        .couplet-left { left: 8px; }
        .couplet-right { right: 8px; animation-delay: -1.5s; }

        .couplet span {
            display: block;
            font-size: 13px; /* Gi·∫£m c·ª° ch·ªØ ƒë·ªÉ c√°c ch·ªØ d√†i nh∆∞ TH·ªäNH, V∆Ø·ª¢NG v·ª´a kh√≠t */
            line-height: 1.2; 
            text-shadow: 1px 1px 2px rgba(0,0,0,0.6);
            width: 100%;
            white-space: nowrap; /* B·∫Øt bu·ªôc kh√¥ng cho r·ªõt xu·ªëng d√≤ng */
        }

        /* Thanh n·∫πp tr√™n d∆∞·ªõi */
        .couplet-cap-top, .couplet-cap-bottom {
            position: absolute; left: 50%; transform: translateX(-50%);
            width: 58px; /* Ph·ªß d√†i h∆°n b·ªÅ ngang khung 1 ch√∫t */
            height: 8px; background: linear-gradient(to right, #ffd700, #e6c300, #ffd700);
            border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        .couplet-cap-top { top: -5px; }
        .couplet-cap-bottom { bottom: -5px; }

        @keyframes floatCouplet { 
            0% { transform: translateY(calc(-50% - 10px)); } 
            100% { transform: translateY(calc(-50% + 10px)); } 
        }

        /* --- 5. N·ªòI DUNG CH√çNH (L·ªúI CH√öC) --- */
        #content {
            display: none; background: #fffaf0;
            padding: 20px 20px; border-radius: 20px;
            box-shadow: 0 0 60px rgba(255, 204, 0, 0.9);
            width: 360px; max-width: 90%;
            border: 3px solid #d41414;
            position: relative; z-index: 20;
            margin-bottom: 10px; 
            max-height: 85dvh; 
            overflow-y: auto; scroll-behavior: smooth; 
        }
        @keyframes popIn { 0% { opacity: 0; transform: scale(0.5); } 100% { opacity: 1; transform: scale(1); } }

        h1.title-tet { color: #d00000; font-size: 24px; font-weight: bold; margin-bottom: 5px; margin-top: 0px;}
        .horse-icons-top { font-size: 28px; margin: 0px 0 10px 0; }
        
        .wishes { 
            font-size: 16px; line-height: 1.6; color: #333; font-style: italic; font-weight: 600; 
            background: #fff; padding: 15px; border-radius: 10px; border: 1px dashed #d00000; margin-bottom: 15px;
            text-align: left;
        }

        .writing-pen {
            display: inline-block; font-size: 20px;
            margin-left: 5px;
            animation: write-move 0.3s infinite alternate;
        }
        @keyframes write-move { 0% { transform: rotate(0deg) translateY(0); } 100% { transform: rotate(15deg) translateY(-5px); } }

        #extra-image-container { display: none; margin-bottom: 15px; }
        .my-custom-img {
            width: 100%; max-width: 100%; border-radius: 10px; border: 3px solid #d00000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); display: block; margin: 0 auto;
            cursor: zoom-in; opacity: 0; filter: blur(20px) brightness(1.2); 
            transform: scale(1.1); animation: cinematicReveal 1.5s ease-out forwards;
        }

        @keyframes cinematicReveal {
            0% { opacity: 0; filter: blur(20px) brightness(1.5); transform: scale(1.15); }
            50% { opacity: 0.8; filter: blur(5px) brightness(1.1); }
            100% { opacity: 1; filter: blur(0) brightness(1); transform: scale(1); }
        }

        /* --- 6. KHU V·ª∞C GAME / CH·ªÆ Tƒ®NH --- */
        #interactive-section { border-top: 1px dashed #d00000; padding-top: 15px; margin-top: 15px; }
        .year-label { display: block; text-align: center; font-size: 22px; font-weight: bold; color: #d00000; margin-top: 0px; margin-bottom: 10px; }
        .scramble-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 4px; margin-bottom: 5px; padding: 0; }
        .letter-chip { background: linear-gradient(to bottom, #ffd700, #fdb931); color: #d00000; font-weight: bold; font-size: 16px; padding: 5px 8px; border-radius: 6px; border: 1px solid #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.2); cursor: pointer; user-select: none; transition: all 0.2s; display: flex; justify-content: center; align-items: center; min-width: 14px; text-align: center; }
        .letter-chip:active { transform: scale(0.95); }
        .letter-chip.selected { border: 1px solid #d00000; background: #fff; color: #d00000; transform: scale(1.15) translateY(-3px); box-shadow: 0 4px 8px rgba(0,0,0,0.3); z-index: 10; }
        .letter-chip.correct { background: #28a745 !important; color: white !important; border-color: #fff !important; cursor: default; animation: popSuccess 0.5s forwards; }
        @keyframes popSuccess { 50% { transform: scale(1.15); background: #20c997; } 100% { transform: scale(1); } }
        .space-chip { width: 10px; } 
        .game-instruction { font-size: 13px; font-style: italic; color: #666; margin-top: 12px; margin-bottom: 10px; animation: blink 2s infinite; padding: 0; text-align: center; display: block; }
        
        .celebration-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.75); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); z-index: 9998; opacity: 0; animation: fadeInOutBackdrop 3s ease-in-out forwards; }
        @keyframes fadeInOutBackdrop { 0% { opacity: 0; } 10% { opacity: 1; } 85% { opacity: 1; } 100% { opacity: 0; } }
        .celebration-popup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0); font-size: 38px; font-weight: 900; color: #ffd700; text-shadow: 0 0 20px #ff0000, 2px 2px 0px #8b0000, -2px -2px 0px #8b0000; z-index: 9999; white-space: nowrap; pointer-events: none; animation: zoomPopCenter 3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        @keyframes zoomPopCenter { 0% { transform: translate(-50%, -50%) scale(0); opacity: 0; } 15% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; } 85% { transform: translate(-50%, -50%) scale(1); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(0.2); opacity: 0; } }
        .static-highlight { display: block; text-align: center; font-size: 26px; font-weight: 900; color: #d00000; text-shadow: 1px 1px 0px rgba(255,255,255,0.5); margin-top: 5px; margin-bottom: 20px; animation: popIn 0.5s; text-wrap: balance; }
        .btn-lucky { display: none; padding: 12px 30px; margin: 0 auto; background: linear-gradient(to right, #ffd700, #fdb931); color: #d00000; font-weight: bold; border-radius: 50px; border: 2px solid #fff; cursor: pointer; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.5); font-size: 16px; transition: transform 0.2s; animation: pulse-gold 1.5s infinite; }
        @keyframes pulse-gold { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); } 50% { transform: scale(1.05); box-shadow: 0 0 0 15px rgba(255, 215, 0, 0); } 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); } }

        /* --- 7. C√ÅC POPUP KH√ÅC (QR, LIGHTBOX) --- */
        #qrOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(100, 0, 0, 0.5); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); z-index: 2000; justify-content: center; align-items: center; flex-direction: column; animation: fadeIn 0.5s; overflow-y: auto; padding: 20px 0; }
        .btn-close-qr { position: absolute; top: 30px; right: 30px; color: #fff; font-size: 40px; cursor: pointer; opacity: 0.8; transition: 0.3s; text-shadow: 0 0 10px rgba(0,0,0,0.5); z-index: 2005; }
        .btn-close-qr:hover { opacity: 1; transform: scale(1.1); }
        .qr-title-large { color: #ffd700; font-size: 28px; font-weight: bold; margin-bottom: 10px; letter-spacing: 1px; text-shadow: 2px 2px 4px rgba(0,0,0,0.6); margin-top: 50px; }
        .qr-note-top { color: #fff; font-style: italic; font-size: 15px; margin-bottom: 15px; text-shadow: 1px 1px 2px rgba(0,0,0,0.8); text-align: center; line-height: 1.4; padding: 0 20px; }
        .qr-img-large { width: 260px; height: 260px; border: 5px solid #ffd700; border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); background: white; margin-bottom: 20px; cursor: zoom-in; transition: transform 0.2s; }
        .qr-img-large:hover { transform: scale(1.02); }
        
        #qrLightbox { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9999; justify-content: center; align-items: center; flex-direction: column; animation: fadeIn 0.3s; }
        .lightbox-img-content { width: auto; height: auto; max-width: 90%; max-height: 80vh; border: 3px solid #ffd700; border-radius: 10px; box-shadow: 0 0 30px rgba(255, 215, 0, 0.5); background-color: #fff; animation: zoomInPopup 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); cursor: zoom-out; }
        @keyframes zoomInPopup { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .lightbox-hint-text { color: #ccc; margin-top: 15px; font-style: italic; font-size: 14px; animation: blink 2s infinite; }
        
        .btn-download-bottom { display: flex; align-items: center; gap: 10px; padding: 10px 25px; background: #d00000; border: 2px solid #ffd700; color: #ffd700; border-radius: 50px; text-decoration: none; font-weight: bold; font-size: 16px; transition: 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.3); cursor: pointer; }
        .btn-download-bottom:hover { transform: scale(1.05); background: #b30000; }
        .final-message { margin-top: 25px; margin-bottom: 50px; font-style: italic; color: #fff; font-size: 15px; max-width: 85%; line-height: 1.6; text-shadow: 0 1px 2px rgba(0,0,0,0.8); background: rgba(0, 0, 0, 0.4); border: 1px dashed #ffd700; padding: 15px 20px; border-radius: 15px; opacity: 0; animation: fadeMsg 2s ease-in-out forwards; animation-delay: 0.5s; }
        @keyframes fadeMsg { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        #shakingModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 3000; justify-content: center; align-items: center; flex-direction: column; }
        .fortune-container { width: 100px; height: 160px; background: linear-gradient(to right, #b30000, #d00000, #b30000); border: 4px solid #ffd700; border-radius: 10px 10px 30px 30px; position: relative; animation: shake-hard 0.4s ease-in-out infinite; box-shadow: 0 10px 30px rgba(0,0,0,0.6); }
        .fortune-container::before { content: ''; position: absolute; top: -15px; left: 5px; width: 82px; height: 25px; background: #800000; border: 4px solid #ffd700; border-radius: 50%; z-index: 2; }
        .sticks-bundle { position: absolute; top: -40px; left: 20px; width: 60px; height: 60px; z-index: 1; }
        .stick-sample { position: absolute; width: 10px; height: 80px; background: #f0e68c; border-radius: 5px; border: 1px solid #d4a017; }
        .stick-sample:nth-child(1) { left: 10px; transform: rotate(-15deg); top: 10px; } .stick-sample:nth-child(2) { left: 25px; transform: rotate(0deg); top: 0px; } .stick-sample:nth-child(3) { left: 40px; transform: rotate(15deg); top: 10px; }
        @keyframes shake-hard { 0% { transform: rotate(0deg) translateY(0); } 25% { transform: rotate(-10deg) translateY(-10px); } 50% { transform: rotate(0deg) translateY(0); } 75% { transform: rotate(10deg) translateY(10px); } 100% { transform: rotate(0deg) translateY(0); } }
        .shaking-text { color: #ffd700; font-size: 22px; font-weight: bold; margin-top: 40px; text-shadow: 0 0 10px #d00000; animation: blink 1s infinite; }
        
        #resultModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 3000; justify-content: center; align-items: center; animation: fadeIn 0.3s; }
        .bamboo-card { width: 300px; min-height: 450px; background: #fdf5e6; border: 8px solid #d4a017; border-radius: 15px; position: relative; display: flex; flex-direction: column; align-items: center; padding: 0; box-shadow: 0 0 50px rgba(255, 215, 0, 0.5); transform: scale(0.1); opacity: 0; animation: card-reveal 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; overflow: hidden; }
        .card-header { width: 100%; height: 70px; background: #d00000; display: flex; justify-content: center; align-items: center; color: #ffd700; font-size: 35px; font-weight: 900; border-bottom: 4px solid #d4a017; text-transform: uppercase; }
        .card-body { padding: 20px; width: 100%; box-sizing: border-box; text-align: center; color: #5c4033; background-image: linear-gradient(#fdf5e6 1px, transparent 1px), linear-gradient(90deg, #fdf5e6 1px, transparent 1px); background-size: 20px 20px; }
        .fortune-rank { display: inline-block; font-size: 32px; font-weight: 900; font-family: 'Dancing Script', cursive, sans-serif; background: linear-gradient(to right, #d00000, #ff0000); -webkit-background-clip: text; -webkit-text-fill-color: transparent; border: 2px solid #d00000; padding: 5px 25px; border-radius: 50px; margin-bottom: 15px; white-space: nowrap; animation: text-blink 1.5s infinite alternate; }
        @keyframes text-blink { 0% { opacity: 1; filter: drop-shadow(0 0 5px rgba(255, 0, 0, 0.8)); transform: scale(1); } 100% { opacity: 0.6; filter: drop-shadow(0 0 0px rgba(255, 0, 0, 0)); transform: scale(1.02); } }
        .fortune-content p { font-size: 15px; line-height: 1.4; margin: 10px 0; font-weight: 600; border-bottom: 1px dashed #ccc; padding-bottom: 5px; text-wrap: balance; }
        .fortune-content b { color: #d00000; font-size: 17px; }
        .poem { margin-top: 15px; font-style: italic; color: #800000; font-weight: bold; font-size: 15px; text-wrap: balance; }
        .btn-get-money-card { margin-top: auto; margin-bottom: 20px; background: linear-gradient(to right, #d00000, #ff0000); color: #fff; border: none; padding: 12px 30px; border-radius: 50px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.3); font-size: 16px; animation: pulse-gold 1.5s infinite; }
        @keyframes card-reveal { 0% { transform: translateY(200px) scale(0.5); opacity: 0; } 100% { transform: translateY(0) scale(1); opacity: 1; } }
        
        .flower { position: absolute; top: -10vh; z-index: 10; pointer-events: none; opacity: 0.8; }
        .firework-shell { position: absolute; top: 0; left: 0; pointer-events: none; z-index: 10000; }
        .firework-particle { position: absolute; border-radius: 50%; animation: realistic-burst 1.2s ease-out forwards, twinkle 0.2s infinite alternate; }
        @keyframes realistic-burst { 0% { transform: translate(0, 0) scale(1); opacity: 1; } 60% { transform: translate(var(--x), var(--y)) scale(0.8); opacity: 0.8; } 100% { transform: translate(var(--x), calc(var(--y) + 100px)) scale(0.4); opacity: 0; } }
        @keyframes twinkle { from { opacity: 1; } to { opacity: 0.7; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>

<body onclick="playAudioForce()">

    <div class="couplet couplet-left" id="coupletLeft">
        <div class="couplet-cap-top"></div>
        <span>V·∫†N</span><span>S·ª∞</span><span>NH∆Ø</span><span>√ù</span>
        <div class="couplet-cap-bottom"></div>
    </div>
    <div class="couplet couplet-right" id="coupletRight">
        <div class="couplet-cap-top"></div>
        <span>AN</span><span>KHANG</span><span>TH·ªäNH</span><span>V∆Ø·ª¢NG</span>
        <div class="couplet-cap-bottom"></div>
    </div>

    <div id="shakingModal">
        <div class="fortune-container">
            <div class="sticks-bundle">
                <div class="stick-sample"></div>
                <div class="stick-sample"></div>
                <div class="stick-sample"></div>
            </div>
        </div>
        <div class="shaking-text">ƒêang xin keo... üôè</div>
    </div>

    <div id="resultModal">
        <div class="bamboo-card">
            <div class="card-header"><div>L·ªôc</div></div>
            <div class="card-body">
                <div class="fortune-rank" id="fortune-word">Ch·ªØ L·ªôc</div>
                <div class="fortune-content" id="fortune-details"></div>
                <div class="poem" id="fortune-poem"></div>
            </div>
            <button class="btn-get-money-card" onclick="revealQR()">Nh·∫≠n L·ªôc Xu√¢n üßß</button>
        </div>
    </div>

    <div id="qrLightbox" onclick="closeLightbox()">
        <img src="" id="lightboxImg" class="lightbox-img-content">
        <div class="lightbox-hint-text">(Ch·∫°m ƒë·ªÉ ƒë√≥ng)</div>
    </div>

    <div id="qrOverlay">
        <div class="btn-close-qr" onclick="closeQR()">√ó</div>
        <div class="qr-title-large" id="qrTitle">L√¨ x√¨ t·∫∑ng em</div>
        <div class="qr-note-top">(S·ª≠ d·ª•ng APP Viettel Money ƒë·ªÉ qu√©t QR<br>Ch·∫°m v√†o m√£ ƒë·ªÉ ph√≥ng to, ho·∫∑c nh·∫•n gi·ªØ ƒë·ªÉ l∆∞u ·∫£nh)</div>
        <img src="" alt="QR Code" class="qr-img-large" id="qrImgMain" onclick="openLightbox(this.src)">
        <div class="btn-download-bottom" onclick="forceDownloadQR()">
            <span>‚¨áÔ∏è</span> T·∫£i m√£ QR
        </div>
        <div class="final-message" id="finalMsg"></div>
    </div>

    <div class="horse-container">
        <div class="horse-unit horse-red galloping">üêé</div>
        <div class="horse-unit horse-gold galloping">üêé</div>
        <div class="horse-unit horse-brown galloping">üêé</div>
    </div>

    <div id="envelope" onclick="openEnvelope()">
        <div class="envelope-icon">üßß</div>
        <div class="year-text">Xu√¢n B√≠nh Ng·ªç<br>2026</div>
        <div class="click-hint">Xin m·ªùi ·∫•n v√†o ƒë√¢y üòç</div>
    </div>

    <div id="content">
        <h1 class="title-tet">Ch√∫c M·ª´ng NƒÉm M·ªõi<br>Xu√¢n B√≠nh Ng·ªç 2026!</h1>
        <div class="horse-icons-top">üêé üêé üêé</div>
        
        <div id="extra-image-container">
            <img src="Anh-2.jpg" id="mainImage" alt="M·∫°nh m·∫Ω nh∆∞ ng·ª±a" class="my-custom-img" onclick="openLightbox(this.src)">
        </div>

        <div class="wishes">
            <span id="type-text"></span>
            <span id="writing-pen" class="writing-pen">üñåÔ∏è</span>

            <div id="interactive-section" style="display: none;">
                
                <div id="boardArea">
                    <div class="year-label">2026 - </div>
                    <div id="wordContainer" class="scramble-container"></div>
                    <div id="gameInstruction" class="game-instruction">(Ch·∫°m v√†o 2 ch·ªØ c√°i ƒë·ªÉ ƒë·ªïi v·ªã tr√≠ cho nhau th√†nh t·ª´ c√≥ nghƒ©a)</div>
                </div>

                <div id="finalTextContainer" style="display: none;">
                    <span class="static-highlight" id="finalText"></span>
                </div>

                <div id="btnLucky" class="btn-lucky" onclick="startShaking()">
                    ‚ú® R√∫t Qu·∫ª L·ªôc ƒê·∫ßu NƒÉm üßß
                </div>
            </div>
        </div>
    </div>

    <div id="speakerHint" class="speaker-hint">Click ƒë·ªÉ nghe nh·∫°c</div>
    <div id="soundBtn" class="sound-control" onclick="toggleSound(event)">üîá</div>

    <audio id="tetMusic" loop>
        <source src="nhac-tet.mp3" type="audio/mpeg">
    </audio>

    <script>
        var music = document.getElementById('tetMusic');
        var soundBtn = document.getElementById('soundBtn');
        var speakerHint = document.getElementById('speakerHint'); 
        var isPlaying = false;

        const PERSON_DATA = {
            "sep_tung": {
                group: "boss",
                wish: "Nh√¢n d·ªãp nƒÉm m·ªõi, em k√≠nh ch√∫c Anh c√πng Gia ƒë√¨nh d·ªìi d√†o s·ª©c kh·ªèe, h·∫°nh ph√∫c, b√¨nh an, v·∫°n s·ª± nh∆∞ √Ω. Em ch√∫c Anh s·∫Ω c√≥ 1 nƒÉm 2026 th·∫≠t th√†nh c√¥ng, d·∫´n d·∫Øt Ph√≤ng KTCN c·ªßa ch√∫ng ta ho√†n th√†nh v∆∞·ª£t m·ªçi ch·ªâ ti√™u v√† ƒë·∫°t ƒë∆∞·ª£c nhi·ªÅu th√†nh t√≠ch cao ·∫°. Em c≈©ng c·∫£m ∆°n Anh ƒë√£ lu√¥n t·∫°o ƒëi·ªÅu ki·ªán, ƒë·ªìng h√†nh v√† h·ªó tr·ª£ ch√∫ng em trong su·ªët 1 nƒÉm qua ·∫° ‚ù§Ô∏è.",
                highlightText: "V∆∞·ª£t K·∫ø ho·∫°ch",
                fortune: {
                    word: "Th·ªëng Lƒ©nh",
                    content: "<p><b>üëë S·ª± Nghi·ªáp:</b><br>Quy·∫øt ƒëo√°n, d·∫´n d·∫Øt ƒë·ªôi ng≈© v∆∞∆°n xa.</p><p><b>üí∞ T√†i L·ªôc:</b><br>V·ªØng v√†ng, gia tƒÉng kh√¥ng ng·ª´ng.</p><p><b>üè° Gia ƒê·∫°o:</b><br>An khang, th·ªãnh v∆∞·ª£ng, sum v·∫ßy.</p>",
                    poem: "\"C·∫ßm qu√¢n v·ªØng l√°i thuy·ªÅn ra bi·ªÉn<br>V·∫°n s·ª± hanh th√¥ng, ph√∫c l·ªôc ti·ªÅn\""
                }
            },
            "sep_doanh": {
                group: "boss",
                wish: "Nh√¢n d·ªãp nƒÉm m·ªõi, em k√≠nh ch√∫c Anh c√πng Gia ƒë√¨nh d·ªìi d√†o s·ª©c kh·ªèe, h·∫°nh ph√∫c, b√¨nh an, v·∫°n s·ª± nh∆∞ √Ω. Em ch√∫c Anh s·∫Ω c√≥ 1 nƒÉm 2026 th·∫≠t th√†nh c√¥ng, d·∫´n d·∫Øt Team ch√∫ng ta lu√¥n g·∫Øn b√≥, ƒëo√†n k·∫øt, ho√†n th√†nh t·ªët m·ªçi nhi·ªám v·ª• ƒë∆∞·ª£c giao. Em c≈©ng c·∫£m ∆°n Anh ƒë√£ lu√¥n t·∫°o ƒëi·ªÅu ki·ªán, l·∫Øng nghe, ƒë·ªìng h√†nh v√† h·ªó tr·ª£ em trong su·ªët 1 nƒÉm qua ·∫° ‚ù§Ô∏è.",
                highlightText: "V∆∞·ª£t K·∫ø ho·∫°ch",
                fortune: {
                    word: "ƒê·∫Øc Th·∫Øng",
                    content: "<p><b>ü§ù ƒê·ªìng ƒê·ªôi:</b><br>Tr√™n d∆∞·ªõi m·ªôt l√≤ng, s·ª©c m·∫°nh v√¥ song.</p><p><b>üöÄ C√¥ng Vi·ªác:</b><br>Thu·∫≠n bu·ªìm xu√¥i gi√≥, thƒÉng ti·∫øn cao.</p><p><b>üí∞ Ti·ªÅn B·∫°c:</b><br>R·ªßng r·ªânh, ƒë·∫ßu t∆∞ ƒë√¢u th·∫Øng ƒë√≥.</p>",
                    poem: "\"Ph√≥ t∆∞·ªõng t√†i ba, m∆∞u l∆∞·ª£c gi·ªèi<br>C√¥ng th√†nh danh to·∫°i, l·ªôc ƒë·∫ßy nh√†\""
                }
            },
            "e_linh": {
                group: "member",
                wish: "Nh√¢n d·ªãp nƒÉm m·ªõi, anh ch√∫c Linh c√≥ th·∫≠t nhi·ªÅu s·ª©c kh·ªèe, h·∫°nh ph√∫c v√† b√¨nh an. Ch√∫c cho nh·ªØng k·∫ø ho·∫°ch, d·ª± ƒë·ªãnh trong nƒÉm 2026 c·ªßa em s·∫Ω ƒë·ªÅu ƒë∆∞·ª£c th·ª±c hi·ªán, g·∫∑t h√°i ƒë∆∞·ª£c nhi·ªÅu k·∫øt qu·∫£ h∆°n n·ªØa trong c√¥ng vi·ªác v√† nhanh ch√≥ng master \"OTC\" nha üòÅ. Ch√∫c ri√™ng chuy·ªán t√¨nh c·∫£m c·ªßa 2 em s·∫Ω lu√¥n m·∫∑n n·ªìng, h·∫°nh ph√∫c, c√πng ƒë·ªìng h√†nh v√† chia s·∫ª v·ªõi nhau nhi·ªÅu h∆°n trong cu·ªôc s·ªëng.",
                highlightText: "T·ª± Tin",
                fortune: {
                    word: "Nh∆∞ √ù",
                    content: "<p><b>üå∏ T√¨nh Duy√™n:</b><br>Hoa n·ªü r·ªô, ng∆∞·ªùi th∆∞∆°ng s·∫Ω t·ªõi.</p><p><b>üíª Code:</b><br>M∆∞·ª£t m√†, kh√¥ng bug, deploy m·ªôt ph√°t ƒÉn ngay.</p><p><b>üí∞ L∆∞∆°ng Th∆∞·ªüng:</b><br>TƒÉng ƒë·ªÅu ƒë·ªÅu, ti·ªÅn ti√™u r·ªßng r·ªânh.</p>",
                    poem: "\"Xu√¢n n√†y h∆°n h·∫≥n m·∫•y xu√¢n qua<br>Ph√∫c l·ªôc ƒë∆∞a nhau ƒë·∫øn t·∫≠n nh√†\""
                }
            },
            "e_kimanh": {
                group: "member",
                wish: "Nh√¢n d·ªãp nƒÉm m·ªõi, anh ch√∫c Kim Anh c√≥ th·∫≠t nhi·ªÅu s·ª©c kh·ªèe, ni·ªÅm vui v√† g·∫∑p nhi·ªÅu may m·∫Øn. V·ªõi c√¥ng vi·ªác, anh ch√∫c em s·∫Ω b·ª©t ph√° h∆°n, c·∫©n th·∫≠n h∆°n, ƒëi·ªÅu g√¨ ƒë√£ l√†m t·ªët th√¨ ti·∫øp t·ª•c ph√°t huy, ƒëi·ªÅu g√¨ c√≤n thi·∫øu s√≥t th√¨ s·∫Ω trau d·ªìi, c·∫£i thi·ªán ƒë·ªÉ t·ªët h∆°n m·ªói ng√†y nh√©. V√† quan tr·ªçng s·ªõm t√¨m ƒë∆∞·ª£c 1 anh ng∆∞·ªùi y√™u ƒë·∫πp zai, nhi·ªÅu xi·ªÅn, v√† chi·ªÅu chu·ªông em nha üòù",
                highlightText: "B·ª©t Ph√°",
                fortune: {
                    word: "C√°t T∆∞·ªùng",
                    content: "<p><b>üíÑ Nhan S·∫Øc:</b><br>Ng√†y c√†ng thƒÉng h·∫°ng, r·∫°ng r·ª° xinh t∆∞∆°i.</p><p><b>üíº S·ª± Nghi·ªáp:</b><br>Qu√Ω nh√¢n ph√π tr·ª£, thƒÉng ti·∫øn v√π v√π.</p><p><b>üçÄ May M·∫Øn:</b><br>ƒêi ƒë√¢u c≈©ng g·∫∑p ƒëi·ªÅu l√†nh.</p>",
                    poem: "\"C√°t t∆∞·ªùng nh∆∞ √Ω, v·∫°n s·ª± an<br>T√†i l·ªôc quanh nƒÉm, ph√∫c ng·∫≠p tr√†n\""
                }
            },
            "e_vinh": {
                group: "member",
                wish: "Nh√¢n d·ªãp nƒÉm m·ªõi, anh ch√∫c Vinh c√≥ th·∫≠t nhi·ªÅu s·ª©c kh·ªèe, h·∫°nh ph√∫c v√† b√¨nh an, m·ªçi chuy·ªán kh√¥ng vui trong nƒÉm c≈© h√£y cho qua h·∫øt nh√©, ƒë·ªÉ ƒë√≥n nh·∫≠n nh·ªØng ƒëi·ªÅu m·ªõi m·∫ª, vui v·∫ª trong nƒÉm m·ªõi. Ch√∫c em s·∫Ω c√≥ 1 nƒÉm 2026 m·∫°nh m·∫Ω, t·ª± tin, c·ªë g·∫Øng nhi·ªÅu h∆°n n·ªØa ƒë·ªÉ th·ª±c hi·ªán m·ªçi m·ª•c ti√™u, k·∫ø ho·∫°ch, ƒë·∫°t ƒë∆∞·ª£c nhi·ªÅu th√†nh t√≠ch cao trong c√¥ng vi·ªác. V√† ƒë·∫∑c bi·ªát, chuy·ªán t√¨nh c·∫£m s·ªõm ƒë∆∞·ª£c ƒë∆°m hoa k·∫øt tr√°i nha üòú",
                highlightText: "M·∫°nh M·∫Ω",
                fortune: {
                    word: "T√†i L·ªôc",
                    content: "<p><b>üí∞ V√≠ Ti·ªÅn:</b><br>L√∫c n√†o c≈©ng d√†y, ti√™u ho√†i kh√¥ng h·∫øt.</p><p><b>üõ†Ô∏è K·ªπ NƒÉng:</b><br>Level up v√π v√π, tr√πm m·ªçi d·ª± √°n.</p><p><b>üòÑ Tinh Th·∫ßn:</b><br>Lu√¥n l·∫°c quan, y√™u ƒë·ªùi ph∆°i ph·ªõi.</p>",
                    poem: "\"Ti·ªÅn v√†o c·ª≠a tr∆∞·ªõc, v√†ng c·ª≠a sau<br>Hai ch·ªØ gi√†u sang ƒë·∫øn r·∫•t mau\""
                }
            },
            "e_duc": {
                group: "member",
                wish: "Nh√¢n d·ªãp nƒÉm m·ªõi, anh ch√∫c ƒê·ª©c c√≥ th·∫≠t nhi·ªÅu s·ª©c kh·ªèe, nhi·ªÅu ni·ªÅm vui v√† g·∫∑p nhi·ªÅu may m·∫Øn. Ch√∫c em 1 nƒÉm 2026 tr∆∞·ªüng th√†nh h∆°n, t·ª± tin h∆°n. Bi·∫øt ƒë∆∞·ª£c ƒëi·ªÉm m·∫°nh ƒë·ªÉ ph√°t huy, ƒëi·ªÉm y·∫øu ƒë·ªÉ trau d·ªìi v√† c·∫£i thi·ªán ng√†y m·ªôt t·ªët h∆°n nh√©.",
                highlightText: "Tr∆∞·ªüng Th√†nh",
                fortune: {
                    word: "B√¨nh An",
                    content: "<p><b>üßò T√¢m Tr√≠:</b><br>An y√™n, kh√¥ng lo √¢u, stress free.</p><p><b>üõ°Ô∏è C√¥ng Vi·ªác:</b><br>V·ªØng ch·∫Øc, ·ªïn ƒë·ªãnh, ƒë∆∞·ª£c tin t∆∞·ªüng.</p><p><b>üíñ T√¨nh C·∫£m:</b><br>·∫§m √°p, ƒë∆∞·ª£c m·ªçi ng∆∞·ªùi y√™u qu√Ω.</p>",
                    poem: "\"B√¨nh an hai ch·ªØ gi√° ng√†n v√†ng<br>Ph√∫ qu√Ω vinh hoa t·ª± x·∫øp h√†ng\""
                }
            },
            "e_trung": {
                group: "member",
                wish: "Nh√¢n d·ªãp nƒÉm m·ªõi, anh ch√∫c Trung c√≥ th·∫≠t nhi·ªÅu s·ª©c kh·ªèe, h·∫°nh ph√∫c, b√¨nh an, v√† ƒë√°nh \"b√†i\" ƒë√¢u th·∫Øng ƒë√≥ nha üòÖ. Ch√∫c em s·∫Ω c√≥ 1 nƒÉm 2026 b·ª©t ph√°, m·ªçi th·ª© ƒë·ªÅu \"auto\" m∆∞·ª£t m√†, th·ª±c hi·ªán ƒë∆∞·ª£c t·∫•t c·∫£ c√°c d·ª± ƒë·ªãnh, k·∫ø ho·∫°ch c·ªßa c√° nh√¢n c≈©ng nh∆∞ trong c√¥ng vi·ªác, ho√†n th√†nh t·ªët m·ªçi b√†i to√°n/ nhi·ªám v·ª• ƒë∆∞·ª£c giao.",
                highlightText: "AUTO M∆∞·ª£t M√†",
                fortune: {
                    word: "ƒê·ªôt Ph√°",
                    content: "<p><b>üß† Tr√≠ Tu·ªá:</b><br>S√°ng su·ªët, gi·∫£i quy·∫øt m·ªçi v·∫•n ƒë·ªÅ h√≥c b√∫a.</p><p><b>üèÉ S·ª©c Kh·ªèe:</b><br>D·∫ªo dai, b·ªÅn b·ªâ nh∆∞ ng·ª±a chi·∫øn.</p><p><b>üìà Th√†nh C√¥ng:</b><br>ƒê·∫°t ƒë∆∞·ª£c c·ªôt m·ªëc quan tr·ªçng m·ªõi.</p>",
                    poem: "\"Ch√≠ l·ªõn tung ho√†nh tr·ªùi ƒë·∫•t r·ªông<br>C√¥ng danh s·ª± nghi·ªáp s√°ng b·ª´ng l√™n\""
                }
            },
            "e_huy": {
                group: "member",
                wish: "Nh√¢n d·ªãp nƒÉm m·ªõi, anh ch√∫c Huy c√πng gia ƒë√¨nh nh·ªè c√≥ th·∫≠t nhi·ªÅu s·ª©c kh·ªèe, h·∫°nh ph√∫c v√† b√¨nh an. Ch√∫c em s·∫Ω th·∫≠t tr∆∞·ªüng th√†nh v√† ch·ªØng ch·∫°c ƒë·ªÉ ƒë√≥n nh·∫≠n 1 c∆∞∆°ng v·ªã, vai tr√≤ m·ªõi trong th·ªùi gian t·ªõi nh√© üòä. V·ªõi c√¥ng vi·ªác, anh ch√∫c em s·∫Ω s·ªõm t√¨m ƒë∆∞·ª£c cho b·∫£n th√¢n h∆∞·ªõng ƒëi ph√π h·ª£p v√† ƒë√∫ng ƒë·∫Øn, d√π ·ªü b·∫•t k·ª≥ m√¥i tr∆∞·ªùng n√†o, v·∫´n lu√¥n t·ª± tin, n·ªó l·ª±c v√† g·∫∑t h√°i ƒë∆∞·ª£c nhi·ªÅu th√†nh c√¥ng üí™.",
                highlightText: "Tr√°ch Nhi·ªám",
                fortune: {
                    word: "V·ªØng B∆∞·ªõc",
                    content: "<p><b>üë®‚Äçüë©‚Äçüëß Gia ƒê√¨nh:</b><br>H·∫°nh ph√∫c vi√™n m√£n, ƒë√≥n nh·∫≠n tin vui.</p><p><b>üíº S·ª± Nghi·ªáp:</b><br>V·ªØng v√†ng, ƒë·ªãnh h∆∞·ªõng r√µ r√†ng, th√†nh c√¥ng ph√≠a tr∆∞·ªõc.</p><p><b>üí™ B·∫£n Lƒ©nh:</b><br>Tr∆∞·ªüng th√†nh, v·ªØng v√†ng tr∆∞·ªõc m·ªçi th·ª≠ th√°ch.</p>",
                    poem: "\"Tr√°ch nhi·ªám tr√™n vai ch√≠ th√™m b·ªÅn<br>Th√†nh c√¥ng g√µ c·ª≠a r·∫°ng t∆∞∆°ng lai\""
                }
            }
        };

        const typeSpeed = 35; 
        let charIndex = 0;
        let isTypingPart2 = false; 
        let selectedPerson = ""; 
        
        window.onload = function() {
            let idParam = new URLSearchParams(window.location.search).get('id');
            if (idParam) idParam = idParam.trim().toLowerCase();

            if (idParam && PERSON_DATA[idParam]) {
                selectedPerson = idParam;
            } else {
                selectedPerson = 'e_linh'; 
            }

            setInterval(createFlower, 350);
            
            music.play().then(() => { 
                isPlaying = true; updateSoundIcon(true);
            }).catch(() => {
                updateSoundIcon(false);
            });
        };

        function updateSoundIcon(playing) {
            if (playing) { soundBtn.innerHTML = 'üîä'; soundBtn.style.animation = 'none'; } 
            else { soundBtn.innerHTML = 'üîá'; soundBtn.style.animation = 'pulse-btn 2s infinite'; }
        }

        function toggleSound(event) {
            event.stopPropagation();
            speakerHint.style.display = 'none';
            if (music.paused) { music.play(); isPlaying = true; updateSoundIcon(true); } 
            else { music.pause(); isPlaying = false; updateSoundIcon(false); }
        }

        function playAudioForce() {
            if (music.paused) {
                music.play().then(() => { isPlaying = true; updateSoundIcon(true); }).catch((e) => console.log(e));
            }
        }

        function openEnvelope() {
            playAudioForce();
            speakerHint.style.display = 'none'; 
            
            document.getElementById('coupletLeft').style.display = 'none';
            document.getElementById('coupletRight').style.display = 'none';

            document.getElementById('envelope').style.display = 'none';
            document.getElementById('content').style.display = 'block';
            showImageAndStartGreeting();
        }

        function showImageAndStartGreeting() {
            const imgContainer = document.getElementById("extra-image-container");
            const greetingImg = document.getElementById("mainImage"); 

            if (PERSON_DATA[selectedPerson].group === 'boss') {
                greetingImg.src = 'Anh-1.jpg'; 
            } else {
                greetingImg.src = 'Anh-2.jpg'; 
            }

            imgContainer.style.display = "block"; 
            setTimeout(typeWriter, 500);
        }

        function typeWriter() {
            const container = document.getElementById("type-text");
            const pen = document.getElementById("writing-pen");
            
            const personInfo = PERSON_DATA[selectedPerson] || PERSON_DATA['e_linh'];
            const textPart1 = personInfo.wish;

            if (!isTypingPart2) {
                if (charIndex < textPart1.length) {
                    container.innerHTML += textPart1.charAt(charIndex);
                    charIndex++;
                    setTimeout(typeWriter, typeSpeed);
                    
                    if(charIndex % 20 === 0) {
                        const contentDiv = document.getElementById('content');
                        contentDiv.scrollTo({ top: contentDiv.scrollHeight, behavior: 'smooth' });
                    }
                } else {
                    isTypingPart2 = true;
                    pen.style.display = "none";
                    initGameOrShowBoss();
                }
            }
        }

        // --- GAME LOGIC ---
        let currentSelected = null;
        let wordOrder = [];
        let correctOrder = [];

        function initGameOrShowBoss() {
            const data = PERSON_DATA[selectedPerson] || PERSON_DATA['e_linh'];
            const interactiveSection = document.getElementById("interactive-section");
            const boardArea = document.getElementById("boardArea");
            const finalTextContainer = document.getElementById("finalTextContainer");
            const finalText = document.getElementById("finalText");
            const btnLucky = document.getElementById("btnLucky");
            const contentDiv = document.getElementById('content');

            interactiveSection.style.display = "block";

            if (data.group === 'boss') {
                boardArea.style.display = "none";
                
                finalText.innerText = "2026 - " + data.highlightText;
                finalTextContainer.style.display = "block";
                btnLucky.style.display = "block"; 
                
                setTimeout(() => {
                    contentDiv.scrollTo({ top: contentDiv.scrollHeight, behavior: 'smooth' });
                }, 200);
            } else {
                boardArea.style.display = "block";
                
                correctOrder = data.highlightText.split('');
                let letters = correctOrder.filter(c => c !== ' ');
                let originalLetters = letters.join('');
                
                shuffleArray(letters);
                while(letters.join('') === originalLetters && letters.length > 1) {
                    shuffleArray(letters);
                }
                
                wordOrder = correctOrder.map(c => c === ' ' ? ' ' : letters.pop());
                renderGame();
                
                setTimeout(() => {
                    contentDiv.scrollTo({ top: contentDiv.scrollHeight, behavior: 'smooth' });
                }, 200);
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function renderGame() {
            const container = document.getElementById("wordContainer");
            container.innerHTML = ''; 
            
            wordOrder.forEach((char, index) => {
                if (char === ' ') {
                    const space = document.createElement("div");
                    space.className = "space-chip";
                    container.appendChild(space);
                } else {
                    const chip = document.createElement("div");
                    chip.className = "letter-chip";
                    if (index === currentSelected) chip.classList.add("selected");
                    chip.innerText = char;
                    chip.onclick = () => handleWordClick(index);
                    container.appendChild(chip);
                }
            });
        }

        function handleWordClick(index) {
            if (document.getElementById("btnLucky").style.display === "block") return;
            if (wordOrder[index] === ' ') return;

            if (currentSelected === null) {
                currentSelected = index;
                renderGame();
            } else {
                if (currentSelected !== index) {
                    let temp = wordOrder[currentSelected];
                    wordOrder[currentSelected] = wordOrder[index];
                    wordOrder[index] = temp;
                    currentSelected = null;
                    renderGame();
                    checkWin();
                } else {
                    currentSelected = null;
                    renderGame();
                }
            }
        }

        function checkWin() {
            if (wordOrder.join('') === correctOrder.join('')) {
                const chips = document.querySelectorAll(".letter-chip");
                chips.forEach(chip => chip.classList.add("correct"));
                
                const instr = document.getElementById("gameInstruction");
                instr.innerText = "Tuy·ªát v·ªùi! Ch√∫c m·ª´ng em!";
                instr.style.color = "#28a745";
                
                setTimeout(() => {
                    document.getElementById("boardArea").style.display = "none";
                    
                    const backdrop = document.createElement("div");
                    backdrop.className = "celebration-backdrop";
                    document.body.appendChild(backdrop);

                    const fullText = "2026 - " + correctOrder.join('');
                    const popup = document.createElement("div");
                    popup.className = "celebration-popup";
                    popup.innerText = fullText;
                    document.body.appendChild(popup);
                    
                    createFirework();
                    setTimeout(createFirework, 800);
                    setTimeout(createFirework, 1600);
                    setTimeout(createFirework, 2400);

                    setTimeout(() => {
                        popup.remove(); 
                        backdrop.remove(); 
                        
                        const finalTextContainer = document.getElementById("finalTextContainer");
                        const finalText = document.getElementById("finalText");
                        finalText.innerText = fullText;
                        finalTextContainer.style.display = "block";
                        
                        const btnLucky = document.getElementById("btnLucky");
                        btnLucky.style.display = "block";
                        
                        const contentDiv = document.getElementById('content');
                        contentDiv.scrollTo({ top: contentDiv.scrollHeight, behavior: 'smooth' });

                        setInterval(createFirework, 1500);

                    }, 3000); 

                }, 800);
            }
        }

        function startShaking() {
            document.getElementById('shakingModal').style.display = 'flex';
            
            const personInfo = PERSON_DATA[selectedPerson] || PERSON_DATA['e_linh'];
            const data = personInfo.fortune;
            
            document.getElementById('fortune-word').innerHTML = data.word || "B√¨nh An";
            document.getElementById('fortune-details').innerHTML = data.content || "<p><b>üçÄ May M·∫Øn:</b><br>M·ªçi s·ª± hanh th√¥ng.</p>";
            document.getElementById('fortune-poem').innerHTML = data.poem || "\"Ph√∫c l·ªôc d·ªìi d√†o v·∫°n s·ª± an\"";

            setTimeout(function() {
                document.getElementById('shakingModal').style.display = 'none';
                document.getElementById('resultModal').style.display = 'flex';
            }, 3000);
        }

        function revealQR() {
            const personInfo = PERSON_DATA[selectedPerson] || PERSON_DATA['e_linh'];
            const group = personInfo.group;

            const qrTitle = document.getElementById('qrTitle');
            const qrImgMain = document.getElementById('qrImgMain');
            const finalMsg = document.getElementById('finalMsg');

            if (group === 'boss') {
                qrTitle.innerText = "Khai Xu√¢n ƒê·∫Øc L·ªôc";
                qrImgMain.src = "qr-sep.jpg";
                finalMsg.innerText = "Tuy gi√° tr·ªã l√¨ x√¨ kh√¥ng l·ªõn, nh∆∞ng ƒë√¢y l√† t·∫•m l√≤ng c·ªßa em g·ª≠i t·ªõi Anh nh√¢n d·ªãp ƒë·∫ßu xu√¢n nƒÉm m·ªõi. K√≠nh ch√∫c Anh m·ªôt nƒÉm B√≠nh Ng·ªç 2026 th·∫≠t nhi·ªÅu s·ª©c kh·ªèe, h·∫°nh ph√∫c v√† th√†nh c√¥ng r·ª±c r·ª°! üòä";
            } else {
                qrTitle.innerText = "May m·∫Øn ƒë·∫ßu xu√¢n";
                qrImgMain.src = "qr-member.jpg";
                finalMsg.innerText = "Tuy gi√° tr·ªã l√¨ x√¨ kh√¥ng l·ªõn, nh∆∞ng hy v·ªçng n√≥ s·∫Ω mang l·∫°i cho em ch√∫t ni·ªÅm vui v√† may m·∫Øn trong ng√†y ƒë·∫ßu nƒÉm üòâ";
            }

            document.getElementById('resultModal').style.display = 'none';
            document.getElementById('content').style.display = 'none';
            document.getElementById('qrOverlay').style.display = 'flex';
        }

        function forceDownloadQR() {
            const imgSrc = document.getElementById('qrImgMain').src;
            fetch(imgSrc)
                .then(resp => resp.blob())
                .then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = url;
                    a.download = 'LiXi_Tet_2026.jpg'; 
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                })
                .catch(() => {
                    const a = document.createElement('a');
                    a.href = imgSrc;
                    a.download = 'LiXi_Tet_2026.jpg';
                    a.click();
                });
        }

        function closeQR() {
            document.getElementById('qrOverlay').style.display = 'none';
            document.getElementById('content').style.display = 'block';
        }

        function openLightbox(imgSrc) {
            const lightbox = document.getElementById("qrLightbox");
            const lightboxImg = document.getElementById("lightboxImg");
            lightboxImg.src = imgSrc; 
            lightbox.style.display = "flex"; 
        }

        function closeLightbox() {
            document.getElementById("qrLightbox").style.display = "none";
        }

        function createFlower() {
            const flower = document.createElement('div');
            flower.className = 'flower';
            flower.innerHTML = Math.random() > 0.5 ? 'üå∏' : 'üåº'; 
            flower.style.left = Math.random() * 100 + 'vw';
            flower.style.fontSize = (Math.random() * 20 + 10) + 'px';
            const duration = Math.random() * 5 + 5;
            flower.style.animation = `fall ${duration}s linear forwards`;
            document.body.appendChild(flower);
            const style = document.createElement('style');
            style.innerHTML = `@keyframes fall { to { transform: translateY(110vh) rotate(${Math.random() * 360}deg); } }`;
            document.head.appendChild(style);
            setTimeout(() => { flower.remove(); style.remove(); }, duration * 1000);
        }

        function createFirework() {
            const shell = document.createElement('div');
            shell.className = 'firework-shell';
            shell.style.left = Math.random() * 90 + 5 + 'vw';
            shell.style.top = Math.random() * 60 + 10 + 'vh';
            document.body.appendChild(shell);
            const colors = ['#ff0000', '#ffff00', '#00ff00', '#00ffff', '#ff00ff', '#ffaa00', '#ffffff'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'firework-particle';
                particle.style.backgroundColor = color;
                const size = Math.random() * 3 + 2 + 'px';
                particle.style.width = size; particle.style.height = size;
                particle.style.boxShadow = `0 0 10px ${color}, 0 0 20px ${color}`;
                const angle = (i / 50) * 360 * (Math.PI / 180);
                const distance = Math.random() * 200 + 50;
                const x = Math.cos(angle) * distance + 'px';
                const y = Math.sin(angle) * distance + 'px';
                particle.style.setProperty('--x', x); particle.style.setProperty('--y', y);
                shell.appendChild(particle);
            }
            setTimeout(() => { shell.remove(); }, 1200);
        }
    </script>
</body>
</html>
